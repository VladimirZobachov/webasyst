"use strict";class SiteEditorInsideIframe{api;$wrapper;delayed_save;constructor(e){this.$wrapper=e.$wrapper,this.api=window.top.registerEditorIframe(this),this.delayed_save={},this.dropdown_open=!0,this.watchClicks()}watchClicks(){const e=this;let t=!1;e.$wrapper.on("close_dropdown",(function(t,o){e.dropdown_open&&e.$wrapper.find(".dropdown.is-opened").each((function(e,t){t===o.target||$.contains(t,o.target)||$(t).waDropdown("dropdown").toggleMenu(!1)}))})),e.$wrapper.on("keydown",(function(o){if("Enter"===o.key&&(document.execCommand("insertLineBreak"),o.preventDefault()),27==o.keyCode){var a=$.Event("keydown",{keyCode:o.keyCode});parent.$("body").trigger(a)}if((o.ctrlKey||o.metaKey)&&(90==o.keyCode||89==o.keyCode)){var r=$.Event("keydown",{keyCode:o.keyCode,ctrlKey:o.ctrlKey,metaKey:o.metaKey});parent.$("body").trigger(r)}o.altKey&&(t||(e.$wrapper.addClass("alt-down"),t=!0))})),e.$wrapper.on("keyup",(function(o){t&&(t=!1,e.$wrapper.removeClass("alt-down"))})),$(window).on("blur",(function(o){t&&(t=!1,e.$wrapper.removeClass("alt-down"))})),e.$wrapper.on("paste",(function(e){e.preventDefault();var t=e.originalEvent.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}))}openAddBlockDialog(e){const t=this;return $.Deferred((o=>{t.api.openAddBlockDialog(e,(e=>{o.resolve(e)}),(()=>{o.reject()}))})).promise()}saveBlockData(e,t,o){void 0===o&&(o=400),this.api.saveBlockData(e,t,{notify_block_settings_form:!0,mode:"update",delay:o})}updateBlockData(e,t){this.api.block_storage.setData(e,t);this.$wrapper.find('[data-block-id="'+e+'"]').trigger("block_data_updated",[e,t])}updateBlockFile(e,t,o){this.api.block_storage.setFile(e,t,o);this.$wrapper.find('[data-block-id="'+e+'"]').trigger("block_file_updated",[e,t,o])}updateBlockSettingsFormConfig(e,t){this.api.block_storage.setFormConfig(e,t)}setSelectedBlock(e,t,o,a=!1){if(this.$wrapper.trigger("close_dropdown",{target:o}),this.api.selected_block_id!=e){try{this.api.setSelectedBlock(e,a)}catch(e){console.log("unable to set selected block",e)}return $("#wa-app").find(".selected-block").removeClass("selected-block"),t.is(".seq-child")&&t.addClass("selected-block"),!0}return!1}}