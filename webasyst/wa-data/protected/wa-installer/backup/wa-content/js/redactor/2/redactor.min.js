/*
    Redactor II
    Version 2.10 (with custom modifications)
    Updated: September 4, 2017

    http://imperavi.com/redactor/

    Copyright (c) 2009-2017, Imperavi LLC.
    License: http://imperavi.com/redactor/license/

    Usage: $('#content').redactor();
*/
!function(p){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t)}});var i=0;function a(t,e){return new a.prototype.init(t,e)}p.fn.redactor=function(i){var o=[],s=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var t,e=p.data(this,"redactor");"-1"!==i.search(/\./)?void 0!==e[(t=i.split("."))[0]]&&(t=e[t[0]][t[1]]):t=e[i],void 0!==e&&p.isFunction(t)?void 0!==(t=t.apply(e,s))&&t!==e&&o.push(t):p.error('No such method "'+i+'" for Redactor')}):this.each(function(){p.data(this,"redactor",{}),p.data(this,"redactor",a(this,i))}),0===o.length?this:1===o.length?o[0]:o},p.Redactor=a,p.Redactor.VERSION="2.10",p.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],p.Redactor.settings={},p.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,stylesClass:!1,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,linkValidation:!0,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link","horizontalrule"],buttonsTextLabeled:!1,buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},keepStyleAttr:[],keepInlineOnEnter:!1,shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",u:"underline",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",general:"General",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",upload:"Upload",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",emptyHtmlRendered:p("").html("​").html(),imageTypes:["image/png","image/jpeg","image/gif","image/webp"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkvimeochannel:/https?:\/\/(www\.)?vimeo.com\/channels\/[^/]+\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif|webp)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},a.fn=p.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(t,e){if(this.$element=p(t),this.uuid=i++,this.sBuffer=[],this.sRebuffer=[],this.loadOptions(e),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit"))return this.loadToEdit(e);this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),p.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,this.build.start()},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(t){this.$element.on("click.redactor-click-to-edit",p.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(e){p.extend(e.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){this.selection.restore(),this.clickToCancelStorage=this.code.get(),p(this.opts.clickToCancel).off(".redactor-click-to-edit"),p(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",p.proxy(function(t){t.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",p(this.opts.clickToCancel).hide(),p(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",p.proxy(function(){this.initToEdit(e)},this)),this.$element.addClass("redactor-click-to-edit")},this)),p(this.opts.clickToSave).off(".redactor-click-to-edit"),p(this.opts.clickToSave).show().on("click.redactor-click-to-edit",p.proxy(function(t){t.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),p(this.opts.clickToCancel).hide(),p(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",p.proxy(function(){this.initToEdit(e)},this)),this.$element.addClass("redactor-click-to-edit")},this))}}),this.$element.redactor(e),this.$element.off(".redactor-click-to-edit")},loadOptions:function(t){var e={};void 0!==p.Redactor.settings.namespace&&!this.$element.hasClass(p.Redactor.settings.namespace)||(e=p.Redactor.settings),this.opts=p.extend({},p.Redactor.opts,this.$element.data(),t),this.opts=p.extend({},this.opts,e)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]})},loadModules:function(){for(var t=p.Redactor.modules.length,e=0;e<t;e++)this.bindModuleMethods(p.Redactor.modules[e])},bindModuleMethods:function(t){if(void 0!==this[t]){this[t]=this[t]();for(var e=this.getModuleMethods(this[t]),i=e.length,o=0;o<i;o++)this[t][e[o]]=this[t][e[o]].bind(this)}},air:function(){return{enabled:!1,collapsed:function(){this.opts.air&&this.selection.get().collapseToStart()},collapsedEnd:function(){this.opts.air&&this.selection.get().collapseToEnd()},build:function(){this.detect.isMobile()||(this.button.hideButtons(),this.button.hideButtonsOnMobile(),0!==this.opts.buttons.length&&(this.$air=this.air.createContainer(),!1!==this.opts.airWidth&&this.$air.css("width",this.opts.airWidth),this.air.append(),this.button.$toolbar=this.$air,this.button.setFormatting(),this.button.load(this.$air),this.core.editor().on("mouseup.redactor",this,p.proxy(function(t){""!==this.selection.text()&&this.air.show(t)},this))))},append:function(){this.$air.appendTo("body")},createContainer:function(){return p("<ul>").addClass("redactor-air").attr({id:"redactor-air-"+this.uuid,role:"toolbar"}).hide()},show:function(t){this.selection.saveInstant(),p(".redactor-air").hide();var e=0,i=this.$air.innerWidth();p(window).width()<t.clientX+i&&(e=200),this.$air.css({left:t.clientX-e+"px",top:t.clientY+10+p(document).scrollTop()+"px"}).show(),this.air.enabled=!0,this.air.bindHide()},bindHide:function(){p(document).on("mousedown.redactor-air."+this.uuid,p.proxy(function(t){var e=p(t.target).closest(".redactor-dropdown").length;0===p(t.target).closest(this.$air).length&&0===e&&!1!==this.air.hide(t)&&this.marker.remove()},this)).on("keydown.redactor-air."+this.uuid,p.proxy(function(t){var e,i=t.which;(this.utils.isRedactorParent(t.target)||p(t.target).hasClass("redactor-in"))&&0===p(t.target).closest("#redactor-modal").length&&(i===this.keyCode.ESC?this.selection.get().collapseToStart():i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE?(e=this.selection.get(),this.selection.range(e).deleteContents()):i===this.keyCode.ENTER&&this.selection.get().collapseToEnd(),this.air.enabled?this.air.hide(t):this.selection.get().collapseToStart())},this))},hide:function(t){if(t.ctrlKey||t.metaKey||t.shiftKey&&t.altKey)return!1;this.button.setInactiveAll(),this.$air.fadeOut(100),this.air.enabled=!1,p(document).off("mousedown.redactor-air."+this.uuid),p(document).off("keydown.redactor-air."+this.uuid)}}},autosave:function(){return{enabled:!1,html:!1,init:function(){this.opts.autosave&&(this.autosave.enabled=!0,this.autosave.name=this.opts.autosaveName||this.$textarea.attr("name"))},is:function(){return this.autosave.enabled},send:function(){var t;this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)&&((t={}).name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t),p.ajax({url:this.opts.autosave,type:"post",data:t}).done(this.autosave.success))},getHiddenFields:function(i){return!1!==this.opts.autosaveFields&&"object"==typeof this.opts.autosaveFields&&p.each(this.opts.autosaveFields,p.proxy(function(t,e){null!==e&&0===e.toString().indexOf("#")&&(e=p(e).val()),i[t]=e},this)),i},success:function(e){var i;try{i=JSON.parse(e)}catch(t){i=e}e=void 0===i.error?"autosave":"autosaveError";this.core.callback(e,this.autosave.name,i),this.autosave.html=this.autosave.source},disable:function(){this.autosave.enabled=!1,clearInterval(this.autosaveTimeout)}}},block:function(){return{format:function(t,e,i,o){if(t="quote"===t?"blockquote":t,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],-1!==p.inArray(t,this.block.tags))return"p"===t&&void 0===e&&(e="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(t,e,i,o):this.block.formatUncollapsed(t,e,i,o)},formatCollapsed:function(t,e,i,o){this.selection.save();var s=this.selection.block(),r=s.tagName.toLowerCase();if(-1!==p.inArray(r,this.block.tags)){var n,a=!1;if(r===t&&void 0===e&&(t="p",a=!0),a&&(this.block.removeAllClass(),this.block.removeAllAttr()),"blockquote"===r&&this.utils.isEndOfElement(s)?(this.marker.remove(),(n=document.createElement("p")).innerHTML=this.opts.invisibleSpace,p(s).after(n),this.caret.start(n),0!==(a=p(s).children().last()).length&&"BR"===a[0].tagName&&a.remove()):n=this.utils.replaceToTag(s,t),"object"==typeof e)for(var l in o=i,e)n=this.block.setAttr(n,l,e[l],o);else n=this.block.setAttr(n,e,i,o);return"pre"===t&&1===n.length&&p(n).html(p.trim(p(n).html())),this.selection.restore(),this.block.removeInlineTags(n),n}this.selection.restore()},formatUncollapsed:function(t,e,i,o){this.selection.save();for(var s,r=[],n=this.selection.blocks(),a=(n=n[0]&&(p(n[0]).hasClass("redactor-in")||p(n[0]).hasClass("redactor-box"))?this.core.editor().find(this.opts.blockTags.join(", ")):n).length,l=0;l<a;l++){var c=n[l].tagName.toLowerCase();if(-1!==p.inArray(c,this.block.tags)&&"figure"!==c){var d=this.utils.replaceToTag(n[l],t);if("object"==typeof e)for(var h in o=i,e)d=this.block.setAttr(d,h,e[h],o);else d=this.block.setAttr(d,e,i,o);r.push(d),this.block.removeInlineTags(d)}}return this.selection.restore(),"pre"===t&&0!==r.length&&(s=r[0],p.each(r,function(t,e){0!==t&&(p(s).append("\n"+p.trim(e.html())),p(e).remove())}),(r=[]).push(s)),r},removeInlineTags:function(t){t=t[0]||t;var e,i=this.opts.inlineTags;-1!==p.inArray(t.tagName,["PRE","H1","H2","H3","H4","H5","H6"])&&("PRE"!==t.tagName&&(e=i.indexOf("a"),i.splice(e,1)),p(t).find(i.join(",")).not(".redactor-selection-marker").contents().unwrap())},setAttr:function(t,e,i,o){return void 0!==e&&(o=void 0===o?"replace":o,t="class"===e?this.block[o+"Class"](i,t):"remove"===o||"removeAll"===o?this.block[o+"Attr"](e,t):this.block[o+"Attr"](e,i,t)),t},getBlocks:function(t){var i,e;return t=void 0===t?this.selection.blocks():t,p(t).hasClass("redactor-box")?(i=[],e=this.core.editor().children(),p.each(e,p.proxy(function(t,e){this.utils.isBlock(e)&&i.push(e)},this)),i):t},replaceClass:function(t,e){return p(this.block.getBlocks(e)).removeAttr("class").addClass(t)[0]},toggleClass:function(t,e){return p(this.block.getBlocks(e)).toggleClass(t)[0]},addClass:function(t,e){return p(this.block.getBlocks(e)).addClass(t)[0]},removeClass:function(t,e){return p(this.block.getBlocks(e)).removeClass(t)[0]},removeAllClass:function(t){return p(this.block.getBlocks(t)).removeAttr("class")[0]},replaceAttr:function(t,e,i){return i=this.block.removeAttr(t,i),p(i).attr(t,e)[0]},toggleAttr:function(i,o,t){t=this.block.getBlocks(t);var s=this,r=[];return p.each(t,function(t,e){p(e).attr(i)?r.push(s.block.removeAttr(i,e)):r.push(s.block.addAttr(i,o,e))}),r},addAttr:function(t,e,i){return p(this.block.getBlocks(i)).attr(t,e)[0]},removeAttr:function(t,e){return p(this.block.getBlocks(e)).removeAttr(t)[0]},removeAllAttr:function(t){t=this.block.getBlocks(t);var i=[];return p.each(t,function(t,e){if(void 0!==e.attributes)for(;e.attributes.length;)e.removeAttribute(e.attributes[0].name);i.push(e)}),i}}},buffer:function(){return{set:function(t){void 0===t&&this.buffer.clear(),void 0===t||"undo"===t?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){var t=this.selection.saveInstant(),e=this.sBuffer[this.sBuffer.length-1],i=this.core.editor().html();void 0!==e&&e[0]===i||this.sBuffer.push([i,t])},setRedo:function(){var t=this.selection.saveInstant();this.sRebuffer.push([this.core.editor().html(),t])},add:function(){this.sBuffer.push([this.core.editor().html(),0])},undo:function(){var t;0!==this.sBuffer.length&&(t=this.sBuffer.pop(),this.buffer.set("redo"),this.core.editor().html(t[0]),this.selection.restoreInstant(t[1]),this.selection.restore(),this.observe.load(),this.code.sync())},redo:function(){var t;0!==this.sRebuffer.length&&(t=this.sRebuffer.pop(),this.buffer.set("undo"),this.core.editor().html(t[0]),this.selection.restoreInstant(t[1]),this.selection.restore(),this.observe.load(),this.code.sync())},clear:function(){this.sRebuffer=[]}}},build:function(){return{start:function(){"inline"===this.opts.type?this.opts.type="inline":"div"===this.opts.type?(""===p.trim(this.$editor.html())&&this.$editor.html(this.opts.emptyHtml),this.build.buildTextarea()):"textarea"===this.opts.type&&this.build.startTextarea(),this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=p('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var t="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id",void 0===t?"redactor-uuid-"+this.uuid:t)},getName:function(){var t=this.$element.attr("name");return void 0===t?"content-"+this.uuid:t},buildTextarea:function(){this.$textarea=p("<textarea>"),this.$textarea.attr("name",this.build.getName()),this.$textarea.hide(),this.$element.after(this.$textarea),this.build.setStartAttrs()},loadFromTextarea:function(){this.$editor=p("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.build.setStartAttrs(),this.$editor.addClass("redactor-layer"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>")},setStartAttrs:function(){this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(t){return this.$element[0].tagName===t},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1,this.opts.air=!1,this.opts.linkify=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),this.opts.stylesClass&&this.core.editor().addClass(this.opts.stylesClass),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth)&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"})},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),(this.opts.toolbar||this.opts.air)&&(this.toolbarsButtons=this.button.init()),this.opts.air?this.air.build():this.opts.toolbar&&this.toolbar.build(),this.detect.isMobile()&&this.opts.toolbarMobile&&this.opts.air&&(this.opts.toolbar=!0,this.toolbar.build()),(this.opts.air||this.opts.toolbar)&&(this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,p.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",p.proxy(function(){this.button.setInactiveAll()},this))),this.modal.templates(),this.build.plugins(),this.autosave.init(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.storage.observe(),this.start=!1},setHelpers:function(){this.opts.linkify&&this.linkify.format(),this.placeholder.init(),this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(t){}},plugins:function(){this.opts.plugins&&p.each(this.opts.plugins,p.proxy(function(t,e){var i=void 0!==RedactorPlugins&&void 0!==RedactorPlugins[e]?RedactorPlugins:a.fn;if(p.isFunction(i[e])){this[e]=i[e]();for(var o,s=this.getModuleMethods(this[e]),r=s.length,n=0;n<r;n++)this[e][s[n]]=this[e][s[n]].bind(this);void 0!==this[e].langs&&(i={},void 0!==this[e].langs[this.opts.lang]?i=this[e].langs[this.opts.lang]:void 0===this[e].langs[this.opts.lang]&&void 0!==this[e].langs.en&&(i=this[e].langs.en),o=this,p.each(i,function(t,e){void 0===o.opts.curLang[t]&&(o.opts.curLang[t]=e)})),p.isFunction(this[e].init)&&this[e].init()}},this))}}},button:function(){return{toolbar:function(){return(void 0!==this.button.$toolbar&&this.button.$toolbar?this.button:this).$toolbar},init:function(){return{format:{title:this.lang.get("format"),icon:!0,dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),icon:!0,label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),icon:!0,label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),icon:!0,label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),icon:!0,label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),icon:!0,dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),icon:!0,func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),icon:!0,func:"list.toggle"},outdent:{title:this.lang.get("outdent"),icon:!0,func:"indent.decrease"},indent:{title:this.lang.get("indent"),icon:!0,func:"indent.increase"},image:{title:this.lang.get("image"),icon:!0,func:"image.show"},file:{title:this.lang.get("file"),icon:!0,func:"file.show"},link:{title:this.lang.get("link"),icon:!0,dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),icon:!0,func:"line.insert"}}},setFormatting:function(){p.each(this.toolbarsButtons.format.dropdown,p.proxy(function(t,e){-1===p.inArray(t,this.opts.formatting)&&delete this.toolbarsButtons.format.dropdown[t]},this))},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(t){p.each(t,p.proxy(function(t,e){e=this.opts.buttons.indexOf(e);-1!==e&&this.opts.buttons.splice(e,1)},this))},load:function(i){this.button.buttons=[],p.each(this.opts.buttons,p.proxy(function(t,e){!this.toolbarsButtons[e]||"file"===e&&!this.file.is()||"image"===e&&!this.image.is()||i.append(p("<li>").append(this.button.build(e,this.toolbarsButtons[e])))},this))},buildButtonTooltip:function(n,t){var a,l,c;this.opts.air||this.detect.isMobile()||((a=p("<span>")).addClass("re-button-tooltip"),a.html(t),(t=0===(t=(c=(l=this).button.toolbar()).closest(".redactor-toolbar-box")).length?c:t).prepend(a),n.on("mouseover",function(){var t,e,i,o,s,r;p(this).hasClass("redactor-button-disabled")||(t=c.hasClass("toolbar-fixed-box")?n.offset():n.position(),t=l.opts.toolbarFixedTarget!==document?n.position():t,e=c.hasClass("toolbar-fixed-box")?n.position().top+l.opts.toolbarFixedTopOffset:t.top,i=n.innerHeight(),o=n.innerWidth(),s=c.hasClass("toolbar-fixed-box")?"fixed":"absolute",s=l.opts.toolbarFixedTarget!==document?"absolute":s,r=l.opts.toolbarFixedTarget!==document?c.position().top:0,a.show(),a.css({top:e+i+r+"px",left:t.left+o/2-a.innerWidth()/2+"px",position:s}))}).on("mouseout",function(){a.hide()}))},build:function(t,e){var i,o,s;if(!1!==this.opts.toolbar)return i=void 0!==e.label?e.label:e.title,(o=p('<a href="javascript:void(null);" alt="'+i+'" rel="'+t+'" />')).addClass("re-button re-"+t),o.attr({role:"button","aria-label":i,tabindex:"-1"}),void 0===e.icon||this.opts.buttonsTextLabeled?o.html(e.title):((s=p("<i>")).addClass("re-icon-"+t),o.append(s),o.addClass("re-button-icon"),this.button.buildButtonTooltip(o,i)),(e.func||e.command||e.dropdown)&&this.button.setEvent(o,t,e),e.dropdown&&(o.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0),s=p('<ul class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">'),o.data("dropdown",s),this.dropdown.build(t,s,e.dropdown)),this.button.buttons.push(o),o},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(o,s,r){o.on("mousedown",p.proxy(function(t){var e,i;return t.preventDefault(),o.hasClass("redactor-button-disabled")||(e="func",i=r.func,r.command?(e="command",i=r.command):r.dropdown&&(i=!(e="dropdown")),this.button.toggle(t,s,e,i)),!1},this))},toggle:function(t,e,i,o,s){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),t.returnValue=!1),"command"===i?this.inline.format(o):"dropdown"===i?this.dropdown.show(t,e):this.button.clickCallback(t,o,e,s),"dropdown"!==i&&this.dropdown.hideAll(!1),this.opts.air&&"dropdown"!==i&&this.air.hide(t),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(t,e,i,o){var s;if(o=void 0===o?i:o,p.isFunction(e))e.call(this,i);else if("-1"!==e.search(/\./)){if(void 0===this[(s=e.split("."))[0]])return;"object"==typeof o?this[s[0]][s[1]].apply(this,o):this[s[0]][s[1]].call(this,o)}else"object"==typeof o?this[e].apply(this,o):this[e].call(this,o);this.observe.buttons(t,i)},all:function(){return this.button.buttons},get:function(t){if(!1!==this.opts.toolbar)return this.button.toolbar().find("a.re-"+t)},set:function(t,e){if(!1!==this.opts.toolbar)return(t=this.button.toolbar().find("a.re-"+t)).html(e).attr("aria-label",e),t},add:function(t,e){return!0!==this.button.isAdded(t)?p():(t=this.button.build(t,{title:e}),this.button.toolbar().append(p("<li>").append(t)),t)},addFirst:function(t,e){return!0!==this.button.isAdded(t)?p():(t=this.button.build(t,{title:e}),this.button.toolbar().prepend(p("<li>").append(t)),t)},addAfter:function(t,e,i){return!0!==this.button.isAdded(e)?p():(e=this.button.build(e,{title:i}),0!==(i=this.button.get(t)).length?i.parent().after(p("<li>").append(e)):this.button.toolbar().append(p("<li>").append(e)),e)},addBefore:function(t,e,i){return!0!==this.button.isAdded(e)?p():(e=this.button.build(e,{title:i}),0!==(i=this.button.get(t)).length?i.parent().before(p("<li>").append(e)):this.button.toolbar().append(p("<li>").append(e)),e)},isAdded:function(t){t=this.opts.buttonsHideOnMobile.indexOf(t);return!(!1===this.opts.toolbar||-1!==t&&this.detect.isMobile())},setIcon:function(t,e){this.opts.buttonsTextLabeled||(t.html(e).addClass("re-button-icon"),this.button.buildButtonTooltip(t,t.attr("alt")))},changeIcon:function(t,e){t=this.button.get(t);0!==t.length&&t.find("i").removeAttr("class").addClass("re-icon-"+e)},addCallback:function(e,i){var o,s;void 0!==e&&!1!==this.opts.toolbar&&(o="dropdown"===i?"dropdown":"func",s=e.attr("rel"),e.on("mousedown",p.proxy(function(t){if(e.hasClass("redactor-button-disabled"))return!1;this.button.toggle(t,s,o,i)},this)))},addDropdown:function(t,e){var i,o;if(!1!==this.opts.toolbar)return t.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0),i=t.attr("rel"),this.button.addCallback(t,"dropdown"),o=p('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+i+'" style="display: none;">'),t.data("dropdown",o),e&&this.dropdown.build(i,o,e),o},setActive:function(t){this.button.get(t).addClass("redactor-act")},setInactive:function(t){this.button.get(t).removeClass("redactor-act")},setInactiveAll:function(t){var e=this.button.toolbar().find("a.re-button");(e=void 0!==t?e.not(".re-"+t):e).removeClass("redactor-act")},disable:function(t){this.button.get(t).addClass("redactor-button-disabled")},enable:function(t){this.button.get(t).removeClass("redactor-button-disabled")},disableAll:function(t){var e=this.button.toolbar().find("a.re-button");(e=void 0!==t?e.not(".re-"+t):e).addClass("redactor-button-disabled")},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled")},remove:function(t){this.button.get(t).remove()}}},caret:function(){return{set:function(t,e,i){var o=this.core.editor().scrollTop(),o=(this.core.editor().focus(),this.core.editor().scrollTop(o),i=void 0===i?0:1,t=t[0]||t,e=e[0]||e,this.selection.get()),s=this.selection.range(o);try{s.setStart(t,0),s.setEnd(e,i)}catch(t){}this.selection.update(o,s)},prepare:function(t){return this.detect.isFirefox()&&void 0!==this.start&&this.core.editor().focus(),t[0]||t},start:function(t){var e,i;if(t=this.caret.prepare(t))return"BR"===t.tagName?this.caret.before(t):(e=p(t).children().first(),i=this.utils.isInlineTag(t.tagName),void(""===t.innerHTML||i?this.caret.setStartEmptyOrInline(t,i):e&&0!==e.length&&this.utils.isInlineTag(e[0].tagName)&&""===e.text()?this.caret.setStartEmptyOrInline(e[0],!0):((i=window.getSelection()).removeAllRanges(),(e=document.createRange()).selectNodeContents(t),e.collapse(!0),i.addRange(e))))},setStartEmptyOrInline:function(t,e){var i=window.getSelection(),o=document.createRange(),s=document.createTextNode("​");o.setStart(t,0),o.insertNode(s),o.setStartAfter(s),o.collapse(!0),i.removeAllRanges(),i.addRange(o),e||this.core.editor().on("keydown.redactor-remove-textnode",function(){p(s).remove(),p(this).off("keydown.redactor-remove-textnode")})},end:function(t){var e,i,o;if(t=this.caret.prepare(t)){if("BR"!==t.tagName&&""===t.innerHTML)return this.caret.start(t);if("BR"===t.tagName)(e=document.createElement("span")).className="redactor-invisible-space",e.innerHTML="&#x200b;",p(t).after(e),(i=window.getSelection()).removeAllRanges(),(o=document.createRange()).setStartBefore(e),o.setEndBefore(e),i.addRange(o),p(e).replaceWith(function(){return p(this).contents()});else{if(t.lastChild&&1===t.lastChild.nodeType)return this.caret.after(t.lastChild);if((i=window.getSelection()).getRangeAt||i.rangeCount)try{(o=i.getRangeAt(0)).selectNodeContents(t),o.collapse(!1),i.removeAllRanges(),i.addRange(o)}catch(t){}}}},after:function(t){var e,i,o;if(t=this.caret.prepare(t)){if("BR"===t.tagName)return this.caret.end(t);this.utils.isBlockTag(t.tagName)?void 0===(i=this.caret.next(t))?this.caret.end(t):("TABLE"===i.tagName?i=p(i).find("th, td").first()[0]:"UL"!==i.tagName&&"OL"!==i.tagName||(i=p(i).find("li").first()[0]),this.caret.start(i)):(i=document.createTextNode("​"),(o=window.getSelection()).removeAllRanges(),(e=document.createRange()).setStartAfter(t),e.insertNode(i),e.setStartAfter(i),e.collapse(!0),o.addRange(e))}},before:function(t){var e,i;(t=this.caret.prepare(t))&&(this.utils.isBlockTag(t.tagName)?void 0===(i=this.caret.prev(t))?this.caret.start(t):("TABLE"===i.tagName?i=p(i).find("th, td").last()[0]:"UL"!==i.tagName&&"OL"!==i.tagName||(i=p(i).find("li").last()[0]),this.caret.end(i)):((i=window.getSelection()).removeAllRanges(),(e=document.createRange()).setStartBefore(t),e.collapse(!0),i.addRange(e)))},next:function(t){t=p(t).next();return(t.hasClass("redactor-script-tag, redactor-selection-marker")?t.next():t)[0]},prev:function(t){t=p(t).prev();return(t.hasClass("redactor-script-tag, redactor-selection-marker")?t.prev():t)[0]},offset:function(t){return this.offset.get(t)}}},clean:function(){return{onSet:function(t){t=this.clean.savePreCode(t),t=this.clean.saveFormTags(t),t=(t=(t=(t=(t=this.opts.script?t.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>'):t).replace(/\$/g,"&#36;")).replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">')).replace(/<span id="selection-marker-1"(.*?[^>]?)>​<\/span>/gi,"###marker1###")).replace(/<span id="selection-marker-2"(.*?[^>]?)>​<\/span>/gi,"###marker2###");var i=this,e=p("<div/>").html(p.parseHTML(t,document,!0)),o=this.opts.replaceTags,s=(o&&(s=Object.keys(this.opts.replaceTags),e.find(s.join(",")).each(function(t,e){i.utils.replaceToTag(e,o[e.tagName.toLowerCase()])})),e.find("span, a").attr("data-redactor-span",!0),e.find(this.opts.inlineTags.join(",")).each(function(){var t=p(this);t.attr("style")&&t.attr("data-redactor-style-cache",t.attr("style"))}),t=e.html(),["font","html","head","link","body","meta","applet"]);return this.opts.script||s.push("script"),t=this.clean.stripTags(t,s),this.opts.removeComments&&(t=t.replace(/<!--[\s\S]*?-->/gi,"")),-1!==(t=(t=(t=this.paragraphize.load(t)).replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">​</span>')).replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">​</span>')).search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)?this.opts.emptyHtml:t},onGet:function(t){return this.clean.onSync(t)},onSync:function(i){if(-1!==(i=(i=i.replace(/\u200B/g,"")).replace(/&#x200b;/gi,"")).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";i=(i=(i=(i=i.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>');var t=p("<div/>").html(p.parseHTML(i,document,!0));t.find('*[style=""]').removeAttr("style"),t.find('*[class=""]').removeAttr("class"),t.find('*[rel=""]').removeAttr("rel"),t.find('*[data-image=""]').removeAttr("data-image"),t.find('*[alt=""]').removeAttr("alt"),t.find('*[title=""]').removeAttr("title"),t.find("*[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),t.find(".redactor-invisible-space, .redactor-unlink").each(function(){p(this).contents().unwrap()}),t.find("span, a").removeAttr("data-redactor-span data-redactor-style-cache").each(function(){0===this.attributes.length&&p(this).contents().unwrap()}),t.find("img").removeAttr("rel"),t.find(".redactor-selection-marker, #redactor-insert-marker").remove(),i=t.html(),this.opts.script&&(i=i.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>")),i=(i=(i=(i=(i=this.clean.restoreFormTags(i)).replace(new RegExp("<br\\s?/?></h","gi"),"</h")).replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(i=i.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(i=(i=i.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'));return p.each({"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"},function(t,e){i=i.replace(new RegExp(t,"g"),e)}),i=i.replace(/\n{2,}/g,"\n\n"),this.opts.removeNewlines&&(i=i.replace(/\r?\n/g,"")),i=this.core.callback("syncClean",i)},onPaste:function(t,e,i){var o,s;return!0!==i&&(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<o:p[^>]*>/gi,"")).replace(/<\/o:p>/gi,""),this.clean.isHtmlMsWord(t))&&(t=this.clean.cleanMsWord(t)),t=p.trim(t),e.pre?this.opts.preSpaces&&(t=t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(0<=t.indexOf("<p")&&0<=t.indexOf("<br")&&(o=p("<div>").html(t),s=this,o.find("p").each(function(){var t=p(this),e=p.trim(t.html().replace(/\n/g," "));0<=e.indexOf("<br")&&p.trim(s.clean.replaceBrToNl(e))&&t.html(e.replace(/\s*<br\s?\/?>\s*/gi,'<br data-keepbr="1">\n'))}),t=o.html()),t=this.clean.replaceBrToNl(t),t=this.clean.replaceNbspToSpaces(t),t=this.clean.removeTagsInsidePre(t)),!0!==i&&(t=this.clean.removeEmptyInlineTags(t),!1===e.encode)&&(t=t.replace(/&/g,"&amp;"),t=this.clean.convertTags(t,e),t=this.clean.getPlainText(t),t=this.clean.reconvertTags(t,e)),e.text&&(t=this.clean.replaceNbspToSpaces(t),t=this.clean.getPlainText(t)),e.lists&&(t=t.replace("\n","<br>")),e.encode&&(t=this.clean.encodeHtml(t)),e.paragraphize&&(t=(t=t.replace(/ \n/g," ")).replace(/\n /g," "),t=(t=this.paragraphize.load(t)).replace(/<p>\s*<\/p>/g,"")),t=(t=t.replace(/<li>\s*<p>/g,"<li>")).replace(/<\/p>\s*<\/li>/g,"</li>"),t=e.pre?t:t.replace(/\n|\r/g," ")},getCurrentType:function(t,e){var i=this.selection.blocks(),t={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(t),blocks:this.clean.isHtmlBlocked(t),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===i.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(t.text=!0,t.paragraphize=!1,t.inline=!1,t.images=!1,t.links=!1,t.line=!0):"inline"===this.opts.type||!1===this.opts.enterKey?(t.paragraphize=!1,t.block=!1,t.line=!0):1===i.length&&this.utils.isCurrentOrParent(["li"])?(t.lists=!0,t.block=!1,t.paragraphize=!1,t.images=!0):1===i.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(t.block=!1,t.paragraphize=!1):("pre"===this.opts.type||1===i.length&&this.utils.isCurrentOrParent("pre"))&&(t.inline=!1,t.block=!1,t.encode=!0,t.pre=!0,t.paragraphize=!1,t.images=!1,t.links=!1),!0===t.line&&(t.paragraphize=!1),!0===e&&(t.text=!1),t},isHtmlBlocked:function(t){var e=t.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),t=t.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==e||null!==t},isHtmlLine:function(t){var e;return!this.clean.isHtmlBlocked(t)&&(e=t.match(/<br\s?\/?>/gi),t=t.match(/\n/gi),!e)&&!t},isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(t){var e=this.opts.inlineTags,i=p("<div/>").html(p.parseHTML(t,document,!0)),o=this,s=i.find("span"),e=i.find(e.join(","));return e.removeAttr("style"),e.each(function(){var t=p(this).html();0===this.attributes.length&&o.utils.isEmpty(t)&&p(this).replaceWith(function(){return p(this).contents()})}),s.each(function(){p(this).html();0===this.attributes.length&&p(this).replaceWith(function(){return p(this).contents()})}),t=(t=(t=(t=i.html()).replace("\x3c!--?php","<?php")).replace("\x3c!--?","<?")).replace("?--\x3e","?>"),i.remove(),t},cleanMsWord:function(t){t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"")).replace(/\n/g," ")).replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n\n");var a=p("<div/>").html(t),l=!1,c=1,d=[];return a.find("p[style]").each(function(){var t=p(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(t){var e=parseInt(t[1]),i=parseInt(t[2]),o=p(this).html().match(/^[\w]+\./)?"ol":"ul",t=p("<li/>").html(p(this).html());if(t.html(t.html().replace(/^([\w\.]+)</,"<")),t.find("span:first").remove(),1==i&&-1==p.inArray(e,d)){var s=p("<"+o+"/>").attr({"data-level":i,"data-list":e}).html(t);p(this).replaceWith(s),l=e,d.push(e)}else{if(c<i){for(var r=a.find('[data-level="'+c+'"][data-list="'+l+'"]'),n=c;n<i;n++)(s=p("<"+o+"/>")).appendTo(r.find("li").last()),r=s;r.attr({"data-level":i,"data-list":e}).html(t)}else a.find('[data-level="'+i+'"][data-list="'+e+'"]').last().append(t);c=i,l=e,p(this).remove()}}}),a.find("[data-level][data-list]").removeAttr("data-level data-list"),t=a.html()},replaceNbspToSpaces:function(t){return t.replace(/&nbsp;/gi," ")},replaceBrToNl:function(t){return t.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},convertTags:function(t,e){var i=p("<div>").html(t),o=(i.find("iframe").remove(),i.find("a"));if(o.removeAttr("style"),!1!==this.opts.pasteLinkTarget&&o.attr("target",this.opts.pasteLinkTarget),e.links&&this.opts.pasteLinks&&i.find("a").each(function(t,e){if(e.href){for(var i,o='##%%a href="'+e.href+'"',s=0,r=e.attributes.length;s<r;s++)"href"!==(i=e.attributes.item(s)).name&&(o+=" "+i.name+'="'+i.value+'"');e.outerHTML=o+"%%##"+e.innerHTML+"##%%/a%%##"}}),t=i.html(),e.images&&this.opts.pasteImages&&(t=t.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'##%%img$1src="$2"$3%%##')),!this.opts.pastePlainText)for(var o=e.lists?["ul","ol","li"]:this.opts.pasteBlockTags,s=e.block||e.lists?e.inline?o.concat(this.opts.pasteInlineTags):o:e.inline?this.opts.pasteInlineTags:[],r=s.length,n=0;n<r;n++)t=t.replace(new RegExp("</"+s[n]+">","gi"),"###/"+s[n]+"###"),t="td"===s[n]||"th"===s[n]?t.replace(new RegExp("<"+s[n]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+s[n]+" $2###"):(this.utils.isInlineTag(s[n])?t=(t=t.replace(new RegExp("<"+s[n]+'([^>]*)class="([^>]*)"[^>]*>',"gi"),"###"+s[n]+' class="$2"###')).replace(new RegExp("<"+s[n]+'([^>]*)data-redactor-style-cache="([^>]*)"[^>]*>',"gi"),"###"+s[n]+' cache="$2"###'):t).replace(new RegExp("<"+s[n]+"[^>]*>","gi"),"###"+s[n]+"###");return t},reconvertTags:function(t,e){if((e.links&&this.opts.pasteLinks||e.images&&this.opts.pasteImages)&&(t=(t=t.replace(new RegExp("##%%","gi"),"<")).replace(new RegExp("%%##","gi"),">")),!this.opts.pastePlainText){for(var i=e.lists?["ul","ol","li"]:this.opts.pasteBlockTags,o=e.block||e.lists?e.inline?i.concat(this.opts.pasteInlineTags):i:e.inline?this.opts.pasteInlineTags:[],s=o.length,r=0;r<s;r++)t=t.replace(new RegExp("###/"+o[r]+"###","gi"),"</"+o[r]+">");for(r=0;r<s;r++)t=t.replace(new RegExp("###"+o[r]+"###","gi"),"<"+o[r]+">");for(var n,r=0;r<s;r++)"td"===o[r]||"th"===o[r]?t=t.replace(new RegExp("###"+o[r]+"s?(.*?[^#])###","gi"),"<"+o[r]+"$1>"):this.utils.isInlineTag(o[r])&&(n="span"===o[r]?' data-redactor-span="true"':"",t=(t=t.replace(new RegExp("###"+o[r]+' cache="(.*?[^#])"###',"gi"),"<"+o[r]+' style="$1"'+n+' data-redactor-style-cache="$1">')).replace(new RegExp("###"+o[r]+"s?(.*?[^#])###","gi"),"<"+o[r]+"$1>"))}return t},cleanPre:function(t){t=void 0===t?p(this.selection.block()).closest("pre",this.core.editor()[0]):t,p(t).find("br").replaceWith(function(){return document.createTextNode("\n")}),p(t).find("p").replaceWith(function(){return p(this).contents()})},removeTagsInsidePre:function(t){var e=p("<div />").append(t);return e.find("pre").replaceWith(function(){var t=p(this).html();return t=(t=t.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/(<([^>]+)>)/gi,""),p("<pre />").append(t)}),t=e.html(),e.remove(),t},getPlainText:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var e=document.createElement("div");return e.innerHTML=t,t=e.textContent||e.innerText,p.trim(t)},savePreCode:function(t){return t=this.clean.savePreFormatting(t),t=this.clean.saveCodeFormatting(t),t=this.clean.restoreSelectionMarkers(t)},savePreFormatting:function(a){var t=a.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==t&&p.each(t,p.proxy(function(t,e){var i,o,s,r=[],n=!1;e.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(n=!0,i=(r=e.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code>(([\n\r\s]+)?)<\/pre>/i))[5],o=r[1],s=r[4]):(i=(r=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i))[2],o=r[1]),i=(i=i.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," "),this.opts.preSpaces&&(i=i.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),i=(i=this.clean.encodeEntities(i)).replace(/\$/g,"&#36;"),a=n?a.replace(e,"<pre"+o+"><code"+s+">"+i+"</code></pre>"):a.replace(e,"<pre"+o+">"+i+"</pre>")},this)),a},saveCodeFormatting:function(o){var t=o.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null!==t&&p.each(t,p.proxy(function(t,e){var i=e.match(/<code(.*?)>([\w\W]*?)<\/code>/i);i[2]=i[2].replace(/&nbsp;/g," "),i[2]=this.clean.encodeEntities(i[2]),i[2]=i[2].replace(/\$/g,"&#36;"),o=o.replace(e,"<code"+i[1]+">"+i[2]+"</code>")},this)),o},restoreSelectionMarkers:function(t){return t=t.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">​</span>')},saveFormTags:function(t){return t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(t){return t.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(t){return t=(t=(t=(t=t.replace(/”/g,'"')).replace(/“/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'"),t=this.clean.encodeEntities(t)},encodeEntities:function(t){return t=(t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(t,i){return void 0===i?t.replace(/(<([^>]+)>)/gi,""):t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,e){return-1===i.indexOf(e.toLowerCase())?t:""})},removeMarkers:function(t){return t.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=p.trim(t)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},removeSpacesHard:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=p.trim(t)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g,"")).replace(/[\s\n]*$/g,"")).replace(/>\s{2,}</g,"><")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var t=this.selection.block();this.utils.isCurrentOrParentHeader()&&t&&t.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(t){t=(t=p.trim(t)).replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">​<\/span>)/,""),"textarea"===this.opts.type?t=this.clean.onSet(t):"div"===this.opts.type&&""===t&&(t=this.opts.emptyHtml),t=t.replace(/<p><span id="selection-marker-1" class="redactor-selection-marker">​<\/span><\/p>/,""),this.events.stopDetectChanges(),this.core.editor().html(t),this.observe.load(),this.events.startDetectChanges()},set:function(t,e){t=p.trim(t),(e=e||{}).start&&(this.start=e.start),"textarea"===this.opts.type?t=this.clean.onSet(t):"div"===this.opts.type&&""===t&&(t=this.opts.emptyHtml),this.core.editor().html(t),this.observe.load(),"textarea"===this.opts.type&&this.code.sync(),this.placeholder.enable()},get:function(){var t;return"textarea"===this.opts.type?this.core.textarea().val():(t=this.core.editor().html(),this.clean.onGet(t))},sync:function(){var t,e;this.code.syncFire&&(t=this.core.editor().html(),e=this.code.cleaned(t),this.code.isSync(e)||(this.code.html=e,"textarea"!==this.opts.type?(this.core.callback("sync",t),this.core.callback("change",t)):"textarea"===this.opts.type&&setTimeout(p.proxy(function(){this.code.startSync(t)},this),10)))},startSync:function(t){t=this.core.callback("syncBefore",t),t=this.clean.onSync(t),this.core.textarea().val(t),this.core.callback("sync",t),!1===this.start&&this.core.callback("change",t),this.start=!1},isSync:function(t){var e=!1!==this.code.html&&this.code.html;return!1!==e&&e===t},cleaned:function(t){return t=t.replace(/\u200B/g,""),this.clean.removeMarkers(t)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return void 0===this.$editor?p():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return this.$toolbar||!1},air:function(){return this.$air||!1},object:function(){return p.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(t){this.core.event=t},getEvent:function(){return this.core.event},callback:function(t,e,i){var o,s=!1,r=p._data(this.core.element()[0],"events");if(void 0!==r&&void 0!==r[t])for(var n,a,l=r[t].length,c=0;c<l;c++)"callback.redactor"===r[t][c].namespace&&(n=r[t][c].handler,s=void 0===(a=void 0===i?[e]:[e,i])?n.call(this,e):n.call(this,e,a));return s||(void 0!==this.opts.callbacks[t]&&(o=this.opts.callbacks[t],p.isFunction(o))?void 0===i?o.call(this,e):o.call(this,e,i):void 0===i?e:i)},destroy:function(){this.opts.destroyed=!0,this.core.callback("destroy"),this.placeholder.destroy(),this.progress.destroy(),p("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-layer-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),p(document).off(".redactor-dropdown"),p(document).off(".redactor-air."+this.uuid),p(document).off("mousedown.redactor-blur."+this.uuid),p(document).off("mousedown.redactor."+this.uuid),p(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),p(window).off(".redactor-toolbar."+this.uuid),p(window).off("touchmove.redactor."+this.uuid),p("body").off("scroll.redactor."+this.uuid),p(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);var i=this,t=(!1!==this.opts.plugins&&p.each(this.opts.plugins,function(t,e){p(window).off(".redactor-plugin-"+e),p(document).off(".redactor-plugin-"+e),p("body").off(".redactor-plugin-"+e),i.core.editor().off(".redactor-plugin-"+e)}),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-layer"),this.core.editor().removeAttr("contenteditable"),this.code.get());this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each(function(){var t=p(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(t).show()),this.opts.air&&this.$air.remove(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),p(".redactor-link-tooltip").remove(),clearInterval(this.autosaveTimeout)}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return-1<this.opts.userAgent.indexOf("firefox")},isIe:function(t){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent)||!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)},isSafari:function(){return!!window.GestureEvent&&navigator.userAgent.match(/safari/i)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(o,s,t){t=this.dropdown.buildFormatting(o,t),p.each(t,p.proxy(function(t,e){var i=this.dropdown.buildItem(t,e);this.observe.addDropdown(i,t,e),s.attr("rel",o).append(i)},this))},buildFormatting:function(t,o){return"format"===t&&!1!==this.opts.formattingAdd&&p.each(this.opts.formattingAdd,p.proxy(function(t,e){var i=this.utils.isBlockTag(e.args[0])?"block":"inline";o[t]={func:"block"==i?"block.format":"inline.format",args:e.args,title:e.title}},this)),o},buildItem:function(e,i){var t,o,s=p("<li />");return void 0!==i.classname&&s.addClass(i.classname),-1!==e.search(/^divider/i)?s.addClass("redactor-dropdown-divider"):(t=p('<a href="#" class="redactor-dropdown-'+e+'" role="button" />'),o=p("<span />").html(i.title),t.append(o),t.on("mousedown",p.proxy(function(t){t.preventDefault(),this.dropdown.buildClick(t,e,i)},this)),s.append(t)),s},buildClick:function(t,e,i){var o;p(t.target).hasClass("redactor-dropdown-link-inactive")||(o=this.dropdown.buildCommand(i),void 0!==i.args?this.button.toggle(t,e,o.type,o.callback,i.args):this.button.toggle(t,e,o.type,o.callback))},buildCommand:function(t){var e={type:"func"};return e.callback=t.func,t.command?(e.type="command",e.callback=t.command):t.dropdown&&(e.type="dropdown",e.callback=t.dropdown),e},show:function(t,e){this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,e),this.dropdown.key=e,this.dropdown.button=this.button.get(this.dropdown.key),this.dropdown.button.hasClass("dropact")?this.dropdown.hide():(this.dropdown.active=this.dropdown.button.data("dropdown").appendTo(document.body),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact"),this.dropdown.getButtonPosition(),this.button.toolbar().hasClass("toolbar-fixed-box")&&this.detect.isDesktop()?this.dropdown.showIsFixedToolbar():this.dropdown.showIsUnFixedToolbar(),this.detect.isDesktop()&&!this.detect.isFirefox()&&(this.dropdown.active.on("mouseover.redactor-dropdown",p.proxy(this.utils.disableBodyScroll,this)),this.dropdown.active.on("mouseout.redactor-dropdown mousedown.redactor-dropdown",p.proxy(this.utils.enableBodyScroll,this))),t.stopPropagation())},showIsFixedToolbar:function(){var t=this.dropdown.button.position().top+this.dropdown.button.innerHeight()+this.opts.toolbarFixedTopOffset,e="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.dropdown.button.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,e="absolute"),this.dropdown.active.css({position:e,left:this.dropdown.position.left+"px",top:t+"px"}).show(),this.dropdown.active.redactorAnimation("slideDown",{duration:.2},p.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},showIsUnFixedToolbar:function(){this.dropdown.active.css({position:"absolute",left:this.dropdown.position.left+"px",top:this.dropdown.button.innerHeight()+this.dropdown.position.top+"px"}).show(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideDown":"show",{duration:.2},p.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},enableEvents:function(){p(document).on("mousedown.redactor-dropdown",p.proxy(this.dropdown.hideAll,this)),this.core.editor().on("touchstart.redactor-dropdown",p.proxy(this.dropdown.hideAll,this)),p(document).on("keyup.redactor-dropdown",p.proxy(this.dropdown.closeHandler,this))},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){this.dropdown.position=this.dropdown.button.offset();var t=this.dropdown.active.width();this.dropdown.position.left+t>p(document).width()&&(this.dropdown.position.left=Math.max(0,this.dropdown.position.left-t+parseInt(this.dropdown.button.innerWidth())))},closeHandler:function(t){t.which===this.keyCode.ESC&&(this.dropdown.hideAll(t),this.core.editor().focus())},hideAll:function(t,e){this.detect.isDesktop()&&this.utils.enableBodyScroll(),!1!==t&&0!==p(t.target).closest(".redactor-dropdown").length||(t=void 0===e?this.button.toolbar().find("a.dropact"):this.button.toolbar().find("a.dropact").not(".re-"+e),0!==(e=void 0===e?p(".redactor-dropdown-"+this.uuid):p(".redactor-dropdown-"+this.uuid).not(".redactor-dropdown-box-"+e)).length&&(p(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),p.each(e,p.proxy(function(t,e){e=p(e);this.core.callback("dropdownHide",e),e.hide(),e.off("mouseover mouseout").off(".redactor-dropdown")},this)),t.removeClass("redactor-act dropact")))},hide:function(){!1!==this.dropdown.active&&(this.detect.isDesktop()&&this.utils.enableBodyScroll(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideUp":"hide",{duration:.2},p.proxy(function(){p(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),this.dropdown.hideOut()},this)))},hideOut:function(){this.core.callback("dropdownHide",this.dropdown.active),this.dropdown.button.removeClass("redactor-act dropact"),this.dropdown.active.off("mouseover mouseout").off(".redactor-dropdown"),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var t=this;setTimeout(function(){t.events.stopChanges=!1},1)},dragover:function(t){t.preventDefault(),t.stopPropagation(),"IMG"===t.target.tagName&&p(t.target).addClass("redactor-image-dragover")},dragleave:function(t){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(t){return t=t.originalEvent||t,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(t.preventDefault(),!1):void 0===window.FormData||!t.dataTransfer||(0===t.dataTransfer.files.length?this.events.onDrop(t):(this.events.onDropUpload(t),void this.core.callback("drop",t)))},click:function(t){var e=this.core.getEvent();this.core.addEvent("click"!==e&&"arrow"!==e&&"click"),this.utils.disableSelectAll(),this.core.callback("click",t)},focus:function(t){var e;this.rtePaste||(this.events.isCallback("focus")&&this.core.callback("focus",t),this.events.focused=!0,(this.events.blured=!1)===this.selection.current()&&(t=this.selection.get(),(e=this.selection.range(t)).setStart(this.core.editor()[0],0),e.setEnd(this.core.editor()[0],0),this.selection.update(t,e)))},blur:function(t){this.start||this.rtePaste||0===p(t.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",t),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var t=-1;this.events.imageEditing=!1,p(window).on("touchmove.redactor."+this.uuid,p.proxy(function(){this.events.imageEditing=!0,-1!==t&&clearTimeout(t),t=setTimeout(p.proxy(function(){this.events.imageEditing=!1},this),500)},this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",p.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",p.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",p.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",p.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",p.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",p.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",p.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",p.proxy(this.events.focus,this)),p(document).on("mousedown.redactor-blur."+this.uuid,p.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var e=this;this.events.observer=new MutationObserver(function(t){t.forEach(p.proxy(e.events.iterateObserver,e))})},iterateObserver:function(t){var e=!1;(e=("textarea"!==this.opts.type&&"div"!==this.opts.type||this.detect.isFirefox()||t.target!==this.core.editor()[0])&&("class"!==t.attributeName||t.target!==this.core.editor()[0])&&"data-vivaldi-spatnav-clickable"!=t.attributeName?e:!0)||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||(this.code.sync(),this.autosave.is()&&(clearTimeout(this.autosaveTimeout),this.autosaveTimeout=setTimeout(p.proxy(this.autosave.send,this),300)))},onDropUpload:function(t){if(t.preventDefault(),t.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){"IMG"===t.target.tagName&&(this.events.dropImage=t.target);for(var e=t.dataTransfer.files,i=e.length,o=0;o<i;o++)this.upload.directUpload(e[o],t)}},onDrop:function(t){this.core.callback("drop",t)},isCallback:function(t){return void 0!==this.opts.callbacks[t]&&p.isFunction(this.opts.callbacks[t])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){return!(!this.opts.fileUpload||!this.opts.fileUpload&&!this.opts.s3)},show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),p("#redactor-filename").val(this.selection.get().toString()),this.modal.show()},insert:function(t,e,i){var o,s;void 0!==t.error?(this.modal.close(),this.core.callback("fileUploadError",t)):(this.file.release(i,e),this.buffer.set(),this.air.collapsed(),i=this.file.text(t),i=p("<a />").attr("href",t.url).text(i),o=void 0===t.id?"":t.id,s=void 0===t.s3?"file":"s3",i.attr("data-"+s,o),i=p(this.insert.node(i)),this.caret.after(i),this.storage.add({type:s,node:i[0],url:t.url,id:o}),null!==e&&this.core.callback("fileUpload",i,t))},release:function(t,e){e?(this.marker.remove(),this.insert.nodeToPoint(t,this.marker.get()),this.selection.restore()):this.modal.close()},text:function(t){var e=p("#redactor-filename").val();return void 0===e||""===e?t.name:e}}},focus:function(){return{start:function(){var t;this.core.editor().focus(),"inline"!==this.opts.type&&!1!==(t=this.focus.first())&&this.caret.start(t)},end:function(){this.core.editor().focus();var t,e,i,o=this.opts.inline?this.core.editor():this.focus.last();0!==o.length&&(t=this.focus.lastChild(o),this.detect.isWebkit()||!1===t?(e=this.selection.get(),null!==(i=this.selection.range(e))?(i.selectNodeContents(o[0]),i.collapse(!1),this.selection.update(e,i)):this.caret.end(o)):this.caret.end(t))},first:function(){var t=this.core.editor().children().first();return 0!==(t=!t.length||"UL"!==t[0].tagName&&"OL"!==t[0].tagName?t:t.find("li").first()).length&&0!==t[0].length&&"BR"!==t[0].tagName&&"HR"!==t[0].tagName&&3!==t[0].nodeType&&t},last:function(){return this.core.editor().children().last()},lastChild:function(t){t=t[0].lastChild;return!(null===t||!this.utils.isInlineTag(t.tagName))&&t},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){var t=this.selection.current();if(t)if(this.utils.isTag(t,"img"))this.events.dropImage=t;else{t=p(t).find("img:first");if(t.length)return this.image.showEdit(t)}this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(t,e,i){var o,s,r,n,a;void 0!==t.error?(this.modal.close(),this.events.dropImage=!1,this.core.callback("imageUploadError",t,i)):!1!==this.events.dropImage?(s=p(this.events.dropImage),this.core.callback("imageDelete",s[0].src,s),s.attr("src",t.url),this.events.dropImage=!1,this.core.callback("imageUpload",s,t),this.modal.close()):(this.placeholder.hide(),o=p("<"+this.opts.imageTag+">"),(s=p("<img>")).attr("src",t.url),a=void 0===t.id?"":t.id,n=void 0===t.s3?"image":"s3",s.attr("data-"+n,a),o.append(s),r=this.utils.isTag(this.selection.current(),"pre"),e?(this.air.collapsed(),this.marker.remove(),i=this.insert.nodeToPoint(i,this.marker.get()),i=p(i).next(),this.selection.restore(),this.buffer.set(),void 0!==i&&0!==i.length&&"IMG"===i[0].tagName?(this.core.callback("imageDelete",i[0].src,i),i.closest("figure, p",this.core.editor()[0]).replaceWith(o)):r?p(r).after(o):this.insert.node(o)):(this.modal.close(),this.buffer.set(),this.air.collapsed(),r?p(r).after(o):this.insert.node(o)),this.caret.after(o),this.events.dropImage=!1,this.storage.add({type:n,node:s[0],url:t.url,id:a}),i=s[0].nextSibling,r=o.next(),n=p(i).text().replace(/\u200B/g,""),a=r.text().replace(/\u200B/g,""),""===n&&p(i).remove(),1===r.length&&"FIGURE"===r[0].tagName&&""===a&&r.remove(),null!==e?this.core.callback("imageUpload",s,t):this.core.callback("imageInserted",s,t))},setEditable:function(e){var t;e.on("dragstart",function(t){t.preventDefault()}),this.opts.imageResizable?(t=p.proxy(function(t){this.observe.image=e,this.image.resizer=this.image.loadEditableControls(e),p(document).on("mousedown.redactor-image-resize-hide."+this.uuid,p.proxy(this.image.hideResize,this)),this.image.resizer&&this.image.resizer.on("mousedown.redactor touchstart.redactor",p.proxy(function(t){this.image.setResizable(t,e)},this))},this),e.off("mousedown.redactor").on("mousedown.redactor",p.proxy(this.image.hideResize,this)),e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",t)):e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",p.proxy(function(t){setTimeout(p.proxy(function(){this.image.showEdit(e)},this),200)},this))},setResizable:function(t,e){t.preventDefault(),this.image.resizeHandle={x:t.pageX,y:t.pageY,el:e,ratio:e.width()/e.height(),h:e.height()},(t=t.originalEvent||t).targetTouches&&(this.image.resizeHandle.x=t.targetTouches[0].pageX,this.image.resizeHandle.y=t.targetTouches[0].pageY),this.image.startResize()},startResize:function(){p(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",p.proxy(this.image.moveResize,this)),p(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",p.proxy(this.image.stopResize,this))},moveResize:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.image.resizeHandle.h,t=(t.targetTouches?e+=t.targetTouches[0].pageY-this.image.resizeHandle.y:e+=t.pageY-this.image.resizeHandle.y,Math.round(e*this.image.resizeHandle.ratio));e<50||t<100||(this.image.resizeHandle.el.attr({width:t,height:e}),this.image.resizeHandle.el.width(t),this.image.resizeHandle.el.height(e),this.code.sync())},stopResize:function(){this.handle=!1,p(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(t){t&&0!==p(t.target).closest("#redactor-image-box",this.$editor[0]).length||(t&&"IMG"==t.target.tagName&&p(t.target),0!==(t=this.$editor.find("#redactor-image-box")).length&&(p("#redactor-image-editter").remove(),p("#redactor-image-resizer").remove(),t.find("img").css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin",""),t.find("img").css("opacity",""),t.replaceWith(function(){return p(this).contents()}),p(document).off("mousedown.redactor-image-resize-hide."+this.uuid),void 0!==this.image.resizeHandle)&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")))},loadResizableControls:function(t,e){var i;return this.opts.imageResizable&&!this.detect.isMobile()?(i=p('<span id="redactor-image-resizer" data-redactor="verified"></span>'),this.detect.isDesktop()||i.css({width:"15px",height:"15px"}),i.attr("contenteditable",!1),e.append(i),e.append(t),i):(e.append(t),!1)},loadEditableControls:function(t){var e,i;if(0===p("#redactor-image-box").length)return(e=p('<span id="redactor-image-box" data-redactor="verified">')).css("float",t.css("float")).attr("contenteditable",!1),"auto"!=t[0].style.margin?(e.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):e.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(e),this.opts.imageEditable&&(this.image.editter=p('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",p.proxy(function(){this.image.showEdit(t)},this)),e.append(this.image.editter),i=this.image.editter.innerWidth(),this.image.editter.css("margin-left","-"+i/2+"px")),this.image.loadResizableControls(t,e)},showEdit:function(t){var e,i,o,s;this.events.imageEditing||(e=(this.observe.image=t).closest("a",this.$editor[0]),o=0!==(i=t.closest("figure",this.$editor[0])).length?i:t,this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",p.proxy(this.image.remove,this)),this.image.buttonSave.on("click",p.proxy(this.image.update,this)),!1===this.opts.imageCaption?p("#redactor-image-caption").val("").hide().prev().hide():0!==(s=t.closest(this.opts.imageTag,this.$editor[0]).find("figcaption"))&&p("#redactor-image-caption").val(s.text()).show(),this.opts.imagePosition?(s=(0!==i.length?"center"===o.css("text-align"):"block"==o.css("display")&&"none"==o.css("float"))?"center":o.css("float"),p("#redactor-image-align").val(s)):p(".redactor-image-position-option").hide(),p("#redactor-image-preview").html(p('<img src="'+t.attr("src")+'" style="max-width: 100%;">')),p("#redactor-image-title").val(t.attr("alt")),0!==e.length&&(p("#redactor-image-link").val(e.attr("href")),"_blank"===e.attr("target"))&&p("#redactor-image-link-blank").prop("checked",!0),p(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&p("#redactor-image-title").focus())},update:function(){var t,e,i=this.observe.image,o=i.closest("a",this.core.editor()[0]),s=p("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,""),s=(i.attr("alt",s).attr("title",s),this.image.setFloating(i),p.trim(p("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,""));""!==s?(e="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",t=new RegExp("^(http|ftp|https)://"+e,"i"),e=new RegExp("^"+e,"i"),-1===s.search(t)&&0===s.search(e)&&this.opts.linkProtocol&&(s=this.opts.linkProtocol+"://"+s),t=!!p("#redactor-image-link-blank").prop("checked"),0===o.length?(e=p('<a href="'+s+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(i)+"</a>"),t&&e.attr("target","_blank"),i=i.replaceWith(e),(o=this.core.editor().find("#redactor-img-tmp")).removeAttr("id")):(o.attr("href",s),t?o.attr("target","_blank"):o.removeAttr("target"))):0!==o.length&&o.replaceWith(this.utils.getOuterHtml(i)),this.image.addCaption(i,o),this.modal.close(),this.buffer.set()},setFloating:function(t){var e=t.closest("figure",this.$editor[0]),i=0!==e.length?e:t,o="",s="",r="",n="";switch(p("#redactor-image-align").val()){case"left":o="left",r="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":o="right",r="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==e.length?n="center":(s="block",r="auto")}i.css({float:o,display:s,margin:r,"text-align":n}),i.attr("rel",t.attr("style"))},addCaption:function(t,e){var i=p("#redactor-image-caption").val(),e=0!==e.length?e:t,t=e.next();0!==t.length&&"FIGCAPTION"===t[0].tagName||(t=!1),""!==i?!1===t?(t=p("<figcaption />").text(i),e.after(t)):t.text(i):!1!==t&&t.remove()},remove:function(t,e,i){e=void 0===e?p(this.observe.image):e,"boolean"!=typeof t&&this.buffer.set(),this.events.stopDetectChanges();var o,s,r=e.closest("a",this.core.editor()[0]),n=e.closest(this.opts.imageTag,this.core.editor()[0]);e.parent();if(!1===this.core.callback("imageDelete",t,e[0]))return t&&t.preventDefault(),!1;0!==p("#redactor-image-box").length&&p("#redactor-image-box").parent(),(0!==n.length?(s=n.prev(),o=n.next(),n):0!==r.length?(r.parent(),r):e).remove(),p("#redactor-image-box").remove(),!1!==t&&(o&&0!==o.length?this.caret.start(o):s&&0!==s.length&&this.caret.end(s)),"boolean"!=typeof t&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.placeholder.enable(),this.code.sync()}}},indent:function(){return{increase:function(){var t,e,i,o,s,r;this.list.get()&&(e=(t=p(this.selection.current()).closest("li")).closest("ul, ol",this.core.editor()[0]),0!==(i=t.closest("li").prev()).length)&&"LI"===i[0].tagName&&(this.buffer.set(),this.utils.isCollapsed()?(s=e[0].tagName,r=p("<"+s+" />"),this.selection.save(),1===(o=i.find("ol").first()).length?o.append(t):(s=e[0].tagName,(r=p("<"+s+" />")).append(t),i.append(r))):(document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize()),this.selection.restore())},decrease:function(){var t;this.list.get()&&(p(this.selection.current()).closest("li").closest("ul, ol",this.core.editor()[0]),this.buffer.set(),document.execCommand("outdent"),t=p(this.selection.current()).closest("li",this.core.editor()[0]),this.utils.isCollapsed()&&this.indent.repositionItem(t),0===t.length&&(document.execCommand("formatblock",!1,"p"),0!==(t=(t=p(this.selection.current())).next()).length)&&"BR"===t[0].tagName&&t.remove(),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore())},repositionItem:function(t){var e=t.next(),e=(0===e.length||"UL"===e[0].tagName&&"OL"===e[0].tagName||t.append(e),t.prev());0!==e.length&&"LI"!==e[0].tagName&&(this.selection.save(),t.parents("li",this.core.editor()[0]).after(t),this.selection.restore())},normalize:function(){this.core.editor().find("li").each(p.proxy(function(t,e){var e=p(e),i="",i=(0!==this.opts.keepStyleAttr.length&&(i=","+this.opts.keepStyleAttr.join(",")),e.find(this.opts.inlineTags.join(",")).not("img"+i).removeAttr("style"),e.parent());0!==i.length&&"LI"===i[0].tagName?i.after(e):0===(i=e.next()).length||"UL"!==i[0].tagName&&"OL"!==i[0].tagName||e.append(i)},this))},removeEmpty:function(t){var e=this.core.editor().find("ul, ol"),i=this.core.editor().find("li");i.each(p.proxy(function(t,e){this.indent.removeItemEmpty(e)},this)),e.each(p.proxy(function(t,e){this.indent.removeItemEmpty(e)},this)),i.each(p.proxy(function(t,e){this.indent.removeItemEmpty(e)},this))},removeItemEmpty:function(t){""===t.innerHTML.replace(/[\t\s\n]/g,"").replace(/<span><\/span>/g,"")&&p(t).remove()}}},inline:function(){return{format:function(t,e,i,o){this.utils.isCurrentOrParent(["PRE","CODE"])||(e=this.inline.getParams(e,i,o),t=this.inline.arrangeTag(t),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(t,e):this.inline.formatUncollapsed(t,e))},formatCollapsed:function(t,e){var i,o,s,r=this.selection.inline();r?(o=r.tagName.toLowerCase())===t?this.utils.isEmpty(r.innerHTML)?(this.caret.after(r),p(r).remove()):(s=this.inline.insertBreakpoint(r,o),this.caret.after(s)):0===p(r).closest(t).length?(i=this.inline.insertInline(t),this.inline.setParams(i,e)):(s=this.inline.insertBreakpoint(r,o),this.caret.after(s)):(i=this.inline.insertInline(t),this.inline.setParams(i,e))},formatUncollapsed:function(s,r){this.selection.save();var t=this.inline.getClearedNodes(),n=(this.inline.setNodesStriked(t,s,r),this.selection.restore(),document.execCommand("strikethrough"),this.selection.saveInstant(),this);this.core.editor().find("strike").each(function(){var t=n.utils.replaceToTag(this,s),e=(n.inline.setParams(t[0],r),t.find(s)),i=t.parent(),o=i.parent();0!==o.length&&o[0].tagName.toLowerCase()===s&&o.html()==i[0].outerHTML?(t.replaceWith(function(){return p(this).contents()}),o.replaceWith(function(){return p(this).contents()})):(0!==e.length&&n.inline.cleanInsideOrParent(e,r),i.html()==t[0].outerHTML&&n.inline.cleanInsideOrParent(i,r),n.detect.isFirefox()&&n.core.editor().find(s+":empty").remove())}),this.selection.restoreInstant()},cleanInsideOrParent:function(t,e){if(e)for(var i in e.data)this.inline.removeSpecificAttr(t,i,e.data[i])},getClearedNodes:function(){for(var t=this.selection.nodes(),e=[],i=t.length,o=0,s=0;s<i;s++)if(p(t[s]).hasClass("redactor-selection-marker")){o=s+2;break}for(s=0;s<i;s++)o<=s&&!this.utils.isBlockTag(t[s].tagName)&&e.push(t[s]);return e},isConvertableAttr:function(t,e,i){var o=p(t).attr(e);if(o)if("style"===e){for(var s=(i=p.trim(i).replace(/;$/,"")).split(";"),r=0,n=0;n<s.length;n++){var a,l=s[n].split(":"),c=p.trim(l[0]),l=p.trim(l[1]);-1!==c.search(/color/)?!(a=p(t).css(c))||a!==l&&this.utils.rgb2hex(a)!==l||r++:p(t).css(c)===l&&r++}if(r===s.length)return 1}else if(o===i)return 1;return 0},isConvertable:function(t,e,i,o){if(e===i){if(!o)return!0;var s,r=0;for(s in o.data)r+=this.inline.isConvertableAttr(t,s,o.data[s]);if(r===Object.keys(o.data).length)return!0}return!1},setNodesStriked:function(t,e,i){for(var o=0;o<t.length;o++){var s=t[o].tagName?t[o].tagName.toLowerCase():void 0,r=t[o].parentNode,n=r&&r.tagName?r.tagName.toLowerCase():void 0;this.inline.isConvertable(r,n,e,i)&&p(r).replaceWith(function(){return p("<strike>").append(p(this).contents())}).attr("data-redactor-inline-converted"),this.inline.isConvertable(t[o],s,e,i)&&p(t[o]).replaceWith(function(){return p("<strike>").append(p(this).contents())})}},insertBreakpoint:function(t,e){(i=document.createElement("span")).id="redactor-inline-breakpoint";var i=this.insert.node(i),i=this.utils.isEndOfElement(t)?"":"<"+e+">",o=(o=this.utils.getOuterHtml(t)).replace(/<span id="redactor-inline-breakpoint"><\/span>/i,"</"+e+">"+i),e=p(o);return p(t).replaceWith(e),i&&this.utils.cloneAttributes(t,e.last()),e.first()},insertInline:function(t){t=document.createElement(t);return this.insert.node(t),this.caret.start(t),t},arrangeTag:function(t){var e=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],i=["strong","strong","em","em","u","del","del","sup","sub"];t=t.toLowerCase();for(var o=0;o<e.length;o++)t===e[o]&&(t=i[o]);return t},getStyleParams:function(t){for(var e={},i=t.trim().replace(/;$/,"").split(";"),o=0;o<i.length;o++){var s=i[o].split(":");s&&(e[s[0].trim()]=s[1].trim())}return e},getParams:function(t,e,i){var o=!1,s="toggle";return"object"==typeof t?(o=t,s=void 0!==e?e:s):void 0!==t&&void 0!==e&&((o={})[t]=e,s=void 0!==i?i:s),!!o&&{func:s,data:o}},setParams:function(t,e){if(e)for(var i in e.data){var o=p(t);"style"===i?(t=this.inline[e.func+"Style"](e.data[i],t),o.attr("data-redactor-style-cache",o.attr("style"))):t="class"===i?this.inline[e.func+"Class"](e.data[i],t):"remove"===e.func?this.inline[e.func+"Attr"](i,t):this.inline[e.func+"Attr"](i,e.data[i],t),"style"===i&&"SPAN"===t.tagName&&o.attr("data-redactor-span",!0)}return t},eachInline:function(t,e){var i,o=void 0===t?this.selection.inlines():[t];if(o)for(var s=0;s<o.length;s++)i=e(o[s])[0];return i},replaceClass:function(e,t){return this.inline.eachInline(t,function(t){return p(t).removeAttr("class").addClass(e)})},toggleClass:function(e,t){return this.inline.eachInline(t,function(t){return p(t).toggleClass(e)})},addClass:function(e,t){return this.inline.eachInline(t,function(t){return p(t).addClass(e)})},removeClass:function(e,t){return this.inline.eachInline(t,function(t){return p(t).removeClass(e)})},removeAllClass:function(t){return this.inline.eachInline(t,function(t){return p(t).removeAttr("class")})},replaceAttr:function(e,t,i){return this.inline.eachInline(i,function(t){return p(t).removeAttr(e).attr(e.value)})},toggleAttr:function(e,t,i){return this.inline.eachInline(i,function(t){return p(t).attr(e)?p(t).removeAttr(e):p(t).attr(e.value)})},addAttr:function(e,i,t){return this.inline.eachInline(t,function(t){return p(t).attr(e,i)})},removeAttr:function(e,t){return this.inline.eachInline(t,function(t){t=p(t);return t.removeAttr(e),"style"===e&&t.removeAttr("data-redactor-style-cache"),t})},removeAllAttr:function(t){return this.inline.eachInline(t,function(t){for(var e=p(t),i=t.attributes.length,o=0;o<i;o++)e.removeAttr(t.attributes[o].name);return e})},removeSpecificAttr:function(t,e,i){var o=p(t);"style"===e?(i=i.split(":")[0].trim(),o.css(i,""),this.utils.removeEmptyAttr(t,"style")&&o.removeAttr("data-redactor-style-cache")):o.removeAttr(e)[0]},hasParentStyle:function(t){var e=t.parent();return 1===e.length&&e[0].tagName===t[0].tagName&&e.html()===t[0].outerHTML&&e},addParentStyle:function(t){var e,i=this.inline.hasParentStyle(t);return i?(e=this.inline.getStyleParams(t.attr("style")),i.css(e),i.attr("data-redactor-style-cache",i.attr("style")),t.replaceWith(function(){return p(this).contents()})):t.attr("data-redactor-style-cache",t.attr("style")),t},replaceStyle:function(i,t){i=this.inline.getStyleParams(i);var o=this;return this.inline.eachInline(t,function(t){var t=p(t),e=(t.removeAttr("style").css(i),t.attr("style"));return e&&t.attr("style",e.replace(/"/g,"'")),t=o.inline.addParentStyle(t)})},toggleStyle:function(n,t){n=this.inline.getStyleParams(n);var a=this;return this.inline.eachInline(t,function(t){var e,i=p(t);for(e in n){var o=n[e],s=i.css(e);(s=a.utils.isRgb(s)?a.utils.rgb2hex(s):s.replace(/"/g,""))===(o=a.utils.isRgb(o)?a.utils.rgb2hex(o):o.replace(/"/g,""))?i.css(e,""):i.css(e,o)}var r=i.attr("style");return r&&i.attr("style",r.replace(/"/g,"'")),a.utils.removeEmptyAttr(t,"style")?i.removeAttr("data-redactor-style-cache"):i=a.inline.addParentStyle(i),i})},addStyle:function(i,t){i=this.inline.getStyleParams(i);var o=this;return this.inline.eachInline(t,function(t){var t=p(t),e=(t.css(i),t.attr("style"));return e&&t.attr("style",e.replace(/"/g,"'")),t=o.inline.addParentStyle(t)})},removeStyle:function(o,t){o=this.inline.getStyleParams(o);var s=this;return this.inline.eachInline(t,function(t){var e,i=p(t);for(e in o)i.css(e,"");return s.utils.removeEmptyAttr(t,"style")?i.removeAttr("data-redactor-style-cache"):i.attr("data-redactor-style-cache",i.attr("style")),i})},removeAllStyle:function(t){return this.inline.eachInline(t,function(t){return p(t).removeAttr("style").removeAttr("data-redactor-style-cache")})},removeStyleRule:function(t){var e=this.selection.parent(),i=this.selection.inlines();this.buffer.set(),e&&"SPAN"===e.tagName&&this.inline.removeStyleRuleAttr(p(e),t);for(var o=0;o<i.length;o++){var s=i[o],r=p(s);-1==p.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)||r.hasClass("redactor-selection-marker")||this.inline.removeStyleRuleAttr(r,t)}},removeStyleRuleAttr:function(t,e){t.css(e,""),this.utils.removeEmptyAttr(t,"style")?t.removeAttr("data-redactor-style-cache"):t.attr("data-redactor-style-cache",t.attr("style"))},update:function(t,e,i,o){t=this.inline.arrangeTag(t);var s=this.inline.getParams(e,i,o),r=this.selection.inlines(),n=[];if(r)for(var a=0;a<r.length;a++){var l=r[a];"*"!==t&&l.tagName.toLowerCase()!==t||n.push(this.inline.setParams(l,s))}return n},removeFormat:function(){this.selection.save();for(var t=this.inline.getClearedNodes(),e=0;e<t.length;e++)1===t[e].nodeType&&p(t[e]).replaceWith(function(){return p(this).contents()});this.selection.restore()}}},insert:function(){return{set:function(t){this.placeholder.hide(),this.code.set(t),this.focus.end(),this.placeholder.enable()},html:function(t,e){this.placeholder.hide(),this.core.editor().focus();var i=this.selection.block(),o=this.selection.inline(),s=(void 0===e&&(e=this.clean.getCurrentType(t,!0),t=this.clean.onPaste(t,e,!0)),t=p.parseHTML(t),p(t).last()),r=this.selection.get(),n=this.selection.range(r);if(n.deleteContents(),this.selection.update(r,n),e.lists){var r=p(t);if(0!==r.length&&("UL"===r[0].tagName||"OL"===r[0].tagName))return void this.insert.appendLists(i,r)}e.blocks&&i?this.utils.isSelectAll()?(this.core.editor().html(t),this.focus.end()):!1===(n=this.utils.breakBlockTag())?this.insert.placeHtml(t):(p(t).children().last().append(this.marker.get()),"start"===n.type?n.$block.before(t):n.$block.after(t),this.selection.restore(),this.core.editor().find("p").each(function(){""===p.trim(this.innerHTML)&&p(this).remove()})):(o&&((r=p("<div/>").html(t)).find(o.tagName.toLowerCase()).each(function(){p(this).contents().unwrap()}),t=r.html(),t=p.parseHTML(t),s=p(t).last()),this.utils.isSelectAll()?(i=p(this.opts.emptyHtml),this.core.editor().html("").append(i),i.html(t),this.caret.end(i)):this.insert.placeHtml(t)),this.utils.disableSelectAll(),e.pre&&this.clean.cleanPre(),this.caret.end(s),this.linkify.format()},text:function(t){t=t.toString(),t=p.trim(t);var e,i,o=document.createElement("div");o.innerHTML=t,void 0!==(t=o.textContent||o.innerText)&&(this.placeholder.hide(),this.core.editor().focus(),o=this.selection.blocks(),t=t.replace(/\n/g," "),this.utils.isSelectAll()?(e=p(this.opts.emptyHtml),this.core.editor().html("").append(e),e.html(t),this.caret.end(e)):(e=this.selection.get(),t=document.createTextNode(t),e.getRangeAt&&e.rangeCount&&((i=e.getRangeAt(0)).deleteContents(),i.insertNode(t),i.setStartAfter(t),i.collapse(!0),this.selection.update(e,i)),1<o.length&&(p(t).wrap("<p>"),this.caret.after(t))),this.utils.disableSelectAll(),this.linkify.format(),this.clean.normalizeCurrentHeading())},raw:function(t){this.placeholder.hide(),this.core.editor().focus();for(var e,i,o=this.selection.get(),s=this.selection.range(o),r=(s.deleteContents(),document.createElement("div")),n=(r.innerHTML=t,document.createDocumentFragment());e=r.firstChild;)i=n.appendChild(e);s.insertNode(n),i&&((s=s.cloneRange()).setStartAfter(i),s.collapse(!0),o.removeAllRanges(),o.addRange(s))},rawAfter:function(t){this.placeholder.hide(),this.core.editor().focus();var e=this.selection.get(),i=this.selection.range(e),o=this.selection.current(),s=document.createElement("div"),t=(s.innerHTML=t,s.firstChild);p(o).after(p(t)),i.setStartAfter(t),i.collapse(!0),e.addRange(i)},node:function(t,e){this.placeholder.hide(),void 0!==this.start&&this.core.editor().focus(),t=t[0]||t;var i=this.selection.block(),o=this.utils.isBlockTag(t.tagName),s=!0;return this.utils.isSelectAll()?(o?this.core.editor().html(t):this.core.editor().html(p("<p>").html(t)),this.code.sync()):o&&i?!1===(o=this.utils.breakBlockTag())?this.insert.placeNode(t,e):("start"===o.type?o.$block.before(t):o.$block.after(t),this.core.editor().find("p:empty").remove()):s=this.insert.placeNode(t,e),this.utils.disableSelectAll(),s&&this.caret.end(t),t},appendLists:function(t,e){var i,o=p(t),s=this.utils.isEmpty(t.innerHTML);s||this.utils.isEndOfElement(t)?(i=o,e.find("li").each(function(){i.after(this),i=p(this)}),s&&o.remove()):this.utils.isStartOfElement(t)?e.find("li").each(function(){o.before(this),i=p(this)}):(s=this.selection.extractEndOfNode(t),o.after(p("<li>").append(s)),o.append(e),i=e),this.marker.remove(),i&&this.caret.end(i),this.linkify.format()},placeHtml:function(t){var e=document.createElement("span");e.id="redactor-insert-marker",e=this.insert.node(e),p(e).before(t),this.selection.restore(),this.caret.after(e),p(e).remove()},placeNode:function(t,e){var i=this.selection.get(),o=this.selection.range(i);if(null==o)return!1;!1!==e&&o.deleteContents(),o.insertNode(t),o.collapse(!1),this.selection.update(i,o)},nodeToPoint:function(t,e){var i,o,s;return this.placeholder.hide(),e=e[0]||e,this.utils.isEmpty()?(e=this.utils.isBlock(e)?e:p("<p />").append(e),this.core.editor().html(e)):(i=t.clientX,t=t.clientY,document.caretPositionFromPoint?(s=document.caretPositionFromPoint(i,t),(o=document.getSelection().getRangeAt(0)).setStart(s.offsetNode,s.offset),o.collapse(!0),o.insertNode(e)):document.caretRangeFromPoint?(o=document.caretRangeFromPoint(i,t)).insertNode(e):void 0!==document.body.createTextRange&&((o=document.body.createTextRange()).moveToPoint(i,t),(s=o.duplicate()).moveToPoint(i,t),o.setEndPoint("EndToEnd",s),o.select())),e},nodeToCaretPositionFromPoint:function(t,e){this.insert.nodeToPoint(t,e)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(t){if(!this.rtePaste){var e=t.which,i=37<=e&&e<=40;if(this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure"),!1===this.core.callback("keydown",t))return t.preventDefault(),!1;if(this.shortcuts.init(t,e),this.keydown.checkEvents(i,e),this.keydown.setupBuffer(t,e),e===this.keyCode.ENTER&&this.keydown.block&&"FIGURE"===this.keydown.block.tagName&&this.detect.isFirefox())return t.preventDefault(),this.keydown.onShiftEnter(t);if(!this.utils.isSelectAll()||e!==this.keyCode.ENTER&&e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE)if(this.keydown.addArrowsEvent(i),this.keydown.setupSelectAll(t,e),this.opts.enterKey||e!==this.keyCode.ENTER){if(this.opts.enterKey&&e===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&e===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&p(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),!this.keyup.lastShiftKey&&e===this.keyCode.SPACE&&(t.ctrlKey||t.shiftKey))return t.preventDefault(),this.keydown.onShiftSpace();if(e===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return t.preventDefault(),this.keydown.onShiftEnter(t);if(e===this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey)return this.keydown.onEnter(t);if(e===this.keyCode.TAB||t.metaKey&&221===e||t.metaKey&&219===e)return this.keydown.onTab(t,e);if(this.detect.isFirefox()&&e===this.keyCode.BACKSPACE&&this.keydown.block&&"P"===this.keydown.block.tagName&&this.utils.isStartOfElement(this.keydown.block))if(0!==(o=p(this.keydown.block).prev()).length)return t.preventDefault(),o.append(this.marker.get()),o.append(p(this.keydown.block).html()),p(this.keydown.block).remove(),void this.selection.restore();if(e===this.keyCode.BACKSPACE||e===this.keyCode.DELETE){if(this.observe.image&&void 0!==this.observe.image&&0!==p("#redactor-image-box").length)return t.preventDefault(),o=this.observe.image.closest("figure, p").prev(),this.image.remove(!1),this.observe.image=!1,void(o&&0!==o.length?this.caret.end(o):this.core.editor().focus());this.keydown.onBackspaceAndDeleteBefore()}if(e===this.keyCode.DELETE){var i=p(this.keydown.block).next();if(this.utils.isEndOfElement(this.keydown.block)&&0!==i.length&&"FIGURE"===i[0].tagName)return i.remove(),!1;if(!(!this.keydown.block||"LI"!==this.keydown.block.tagName)&&this.keydown.block){var o=p(this.keydown.block).parents("ul, ol").last(),s=o.next();if(this.utils.isRedactorParent(o)&&this.utils.isEndOfElement(o)&&0!==s.length&&("UL"===s[0].tagName||"OL"===s[0].tagName))return t.preventDefault(),o.append(s.contents()),s.remove(),!1}if(this.utils.isEndOfElement(this.keydown.block)&&0!==i.length&&"PRE"===i[0].tagName)return p(this.keydown.block).append(i.text()),i.remove(),!1}if(e===this.keyCode.DELETE&&0!==p("#redactor-image-box").length&&this.image.remove(),e===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(t),this.list.combineAfterAndBefore(this.keydown.block))return void t.preventDefault();o=this.selection.block();if(o&&"LI"===o.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void t.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)}e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(t)}else t.preventDefault(),s=this.selection.get(),(i=this.selection.range(s)).collapsed||i.deleteContents();else t.preventDefault(),this.code.set(this.opts.emptyHtml),this.events.changeHandler()}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(t){return this.buffer.set(),this.keydown.figure?this.insert.rawAfter("<br>"):this.keydown.pre?this.keydown.insertNewLine(t):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(e){setTimeout(p.proxy(function(){this.code.syncFire=!1,this.keydown.removeEmptyLists();var t="";0!==this.opts.keepStyleAttr.length&&(t=","+this.opts.keepStyleAttr.join(",")),this.core.editor().find("*[style]").not("p, h1, h2, h3, h4, h5, h6, div, ul, li, img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+t).removeAttr("style"),this.keydown.formatEmpty(e),this.code.syncFire=!0},this),1)},onEnter:function(t){if(!1===this.core.callback("enter",t))return t.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(t))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(t);if(this.keydown.figure)setTimeout(p.proxy(function(){this.keydown.replaceToParagraph("FIGURE")},this),1);else if(this.keydown.block){if(setTimeout(p.proxy(function(){this.keydown.replaceToParagraph("DIV")},this),1),"LI"===this.keydown.block.tagName){var e=this.selection.current(),e=p(e).closest("li",this.$editor[0]),i=e.parents("ul,ol",this.$editor[0]).last();if(0!==e.length&&this.utils.isEmpty(e.html())&&0===i.next().length&&this.utils.isEmpty(i.find("li").last().html()))return i.find("li").last().remove(),e=p(this.opts.emptyHtml),i.after(e),this.caret.start(e),!1}}else if(!this.keydown.block)return this.keydown.insertParagraph(t);this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?this.keydown.insertBreakLine(t):(this.opts.keepInlineOnEnter||setTimeout(p.proxy(function(){var t,e=this.selection.inline();e&&this.utils.isEmpty(e.innerHTML)&&(t=this.selection.block(),p(e).remove(),(e=document.createRange()).setStart(t,0),t=document.createTextNode("​"),e.insertNode(t),e.setStartAfter(t),e.collapse(!0),(t=window.getSelection()).removeAllRanges(),t.addRange(e))},this),1),setTimeout(p.proxy(function(){var t=this.selection.block().childNodes,t=t[t.length-1];t&&3!==t.nodeType&&"BR"===t.tagName&&p(t).remove()},this),1))},checkEvents:function(t,e){t||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(e)&&this.buffer.set())},checkKeyEvents:function(t){var e=this.keyCode,e=[e.BACKSPACE,e.DELETE,e.ENTER,e.ESC,e.TAB,e.CTRL,e.META,e.ALT,e.SHIFT];return-1===p.inArray(t,e)},addArrowsEvent:function(t){t&&("click"===this.core.getEvent()||"arrow"===this.core.getEvent()?this.core.addEvent(!1):this.core.addEvent("arrow"))},setupBuffer:function(t,e){this.keydown.ctrl&&90===e&&!t.shiftKey&&!t.altKey&&this.sBuffer.length?(t.preventDefault(),this.buffer.undo()):this.keydown.ctrl&&90===e&&t.shiftKey&&!t.altKey&&0!==this.sRebuffer.length?(t.preventDefault(),this.buffer.redo()):this.keydown.ctrl||e!==this.keyCode.SPACE&&e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE&&(e!==this.keyCode.ENTER||t.ctrlKey||t.shiftKey)||this.buffer.set()},exitFromBlockquote:function(t){return this.utils.isEndOfElement(this.keydown.blockquote)&&-1!==this.clean.removeSpacesHard(p(this.keydown.blockquote).html()).search(/(<br\s?\/?>){1}$/i)?(t.preventDefault(),p(this.keydown.blockquote).children().last().filter("br").remove(),p(this.keydown.blockquote).children().last().filter("span").remove(),t=p(this.opts.emptyHtml),p(this.keydown.blockquote).after(t),this.caret.start(t),!0):void 0},onArrowDown:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertAfterLastElement(t[e]),!1},onArrowUp:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertBeforeFirstElement(t[e]),!1},insertAfterLastElement:function(t){var e;this.utils.isEndOfElement(t)&&(e=this.core.editor().contents().last(),0===("FIGCAPTION"===t.tagName?p(this.keydown.block).parent():p(this.keydown.block)).next().length)&&(0===e.length&&e[0]!==t?this.caret.start(e):(e=p(this.opts.emptyHtml),("FIGCAPTION"===t.tagName?p(t).parent():p(t)).after(e),this.caret.start(e)))},insertBeforeFirstElement:function(t){var e;!this.utils.isStartOfElement()||1<this.core.editor().contents().length&&this.core.editor().contents().first()[0]!==t||(e=p(this.opts.emptyHtml),p(t).before(e),this.caret.start(e))},onTab:function(t,e){if(!this.opts.tabKey)return!0;var i=this.keydown.block&&"LI"===this.keydown.block.tagName;if(this.utils.isEmpty(this.code.get())||!i&&!this.keydown.pre&&!1===this.opts.tabAsSpaces)return!0;t.preventDefault(),this.buffer.set();var o,i=i&&this.utils.isStartOfElement(this.keydown.block);return this.keydown.pre&&!t.shiftKey?(o=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("\t"),this.insert.node(o)):!1===this.opts.tabAsSpaces||i?t.metaKey&&219===e||(!t.metaKey||221!==e)&&t.shiftKey?this.indent.decrease():this.indent.increase():(o=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(o)),!1},setupSelectAll:function(t,e){this.keydown.ctrl&&65===e?this.utils.enableSelectAll():(this.keydown.ctrl&&(35==e||36==e||38==e||40==e)||e!==this.keyCode.LEFT_WIN&&!this.keydown.ctrl)&&this.utils.disableSelectAll()},insertNewLine:function(t){t.preventDefault();var t=document.createTextNode("\n"),e=this.selection.get(),e=this.selection.range(e);return e.deleteContents(),e.insertNode(t),this.caret.after(t),!1},insertParagraph:function(t){t.preventDefault();var t=document.createElement("p"),e=(t.innerHTML="<br>",this.selection.get()),e=this.selection.range(e);return e.deleteContents(),e.insertNode(t),this.caret.start(t),!1},insertBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t)},insertDblBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t,!0)},insertBreakLineProcessing:function(t,e){t.stopPropagation();t=document.createElement("br");return this.insert.node(t),!0===e?(e=document.createElement("br"),this.insert.node(e),this.caret.after(e)):this.caret.after(t),!1},wrapToParagraph:function(){var t=p(this.keydown.current),e=p("<p>").append(t.clone()),t=(t.replaceWith(e),p(e).next());void 0!==t[0]&&"BR"===t[0].tagName&&t.remove(),this.caret.end(e)},replaceToParagraph:function(t){var e,i=this.selection.block(),o=p(i).prev(),s=i.innerHTML.replace(/<br\s?\/?>/gi,"");return i.tagName===t&&this.utils.isEmpty(s)&&!p(i).hasClass("redactor-in")?(e=document.createElement("p"),p(i).replaceWith(e),this.keydown.setCaretToParagraph(e),!1):"P"===i.tagName?(p(i).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(s)&&this.utils.isInline(this.keydown.parent)&&p(i).on("input",p.proxy(function(){var t=this.selection.parent();this.utils.isInline(t)&&(t=p(t).html(),p(i).html(t),this.caret.end(i)),p(i).off("keyup")},this)),!1):o.hasClass(this.opts.videoContainerClass)?(o.removeAttr("class"),e=document.createElement("p"),o.replaceWith(e),this.keydown.setCaretToParagraph(e),!1):void 0},setCaretToParagraph:function(t){var e=document.createRange(),t=(e.setStart(t,0),document.createTextNode("​")),t=(e.insertNode(t),e.setStartAfter(t),e.collapse(!0),window.getSelection());t.removeAllRanges(),t.addRange(e)},removeInvisibleSpace:function(){var t=p(this.keydown.current);0===t.text().search(/^\u200B$/g)&&t.remove()},removeEmptyListInTable:function(t){var e=p(this.keydown.current),i=p(this.keydown.parent),o=e.closest("td",this.$editor[0]);0!==o.length&&e.closest("li",this.$editor[0])&&1===i.children("li").length&&this.utils.isEmpty(e.text())&&(t.preventDefault(),e.remove(),i.remove(),this.caret.start(o))},removeEmptyLists:function(){function t(){""===p.trim(this.innerHTML).replace(/\/t\/n/g,"")&&p(this).remove()}this.core.editor().find("li").each(t),this.core.editor().find("ul, ol").each(t)},formatEmpty:function(t){var e=p.trim(this.core.editor().html());if(this.utils.isEmpty(e))return t.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(this.core.editor().html(this.opts.emptyHtml),this.focus.start()),!1}}},keyup:function(){return{init:function(t){if(!this.rtePaste){var e=t.which;if(this.keyup.block=this.selection.block(),this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent(),this.keyup.lastShiftKey=t.shiftKey,!1===this.core.callback("keyup",t))return t.preventDefault(),!1;if(e===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName){var t=p(this.keyup.block).prev();if(0!==t.length&&"FIGURE"===t[0].tagName)return t=this.utils.replaceToTag(t,"p"),void this.caret.start(t)}if(e===this.keyCode.BACKSPACE||e===this.keyCode.DELETE){if(this.utils.isSelectAll())return this.focus.start(),void this.toolbar.setUnfixed();this.keyup.block&&"P"===this.keyup.block.tagName&&(t=p(this.keyup.block).find("img").length,""===p(this.keyup.block).text().replace(/\u200B/g,""))&&0!==t&&this.utils.replaceToTag(this.keyup.block,"figure"),this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===p(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}this.linkify.isKey(e)&&(this.selection.save(),this.linkify.format(),this.selection.restore())}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(t){return void 0!==this.opts.curLang[t]?this.opts.curLang[t]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var t=this.core.editor().find("#redactor-hr-tmp-id");return t.removeAttr("id"),this.core.callback("insertedLine",t),t},getLineHtml:function(){var t='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(t+="<p>"+this.opts.emptyHtml+"</p>"),t},removeOnBackspace:function(t){var e;this.utils.isCollapsed()&&0!==(e=p(this.selection.block())).length&&this.utils.isStartOfElement(e)&&(e=e.prev())&&0!==e.length&&"HR"===e[0].tagName&&(t.preventDefault(),e.remove())}}},link:function(){return{get:function(){return p(this.selection.inlines("a"))},is:function(){var t=this.selection.nodes(),e=p(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===e.length||1<t.length)&&e},unlink:function(t){void 0!==t&&t.preventDefault&&t.preventDefault(),this.buffer.set();var t=this.selection.inlines("a");0!==t.length&&(t=this.link.replaceLinksToText(t),this.observe.closeAllTooltip(),this.core.callback("deletedLink",t))},insert:function(t,e){var i=this.link.is();return(!0===e||!1!==(t=this.link.buildLinkFromObject(i,t)))&&(this.buffer.set(),t=this.core.callback("beforeInsertingLink",t),!1===i?(i=p("<a />"),i=this.link.update(i,t),e=(i=p(this.insert.node(i))).parent(),!1===this.utils.isRedactorParent(e)&&i.wrap("<p>"),e.hasClass("redactor-unlink")&&e.replaceWith(function(){return p(this).contents()}),this.caret.after(i),this.core.callback("insertedLink",i)):(i=this.link.update(i,t),this.caret.after(i)),i)},update:function(t,e){return t.text(e.text),t.attr("href",e.url),this.link.target(t,e.target),t},target:function(t,e){return e?t.attr("target","_blank"):t.removeAttr("target")},show:function(t){void 0!==t&&t.preventDefault&&t.preventDefault(),this.observe.closeAllTooltip();var t=this.link.linkEl(),e=(this.link.buildModal(t),this.link.buildLinkFromElement(t));e.url=this.link.removeSelfHostFromUrl(e.url),this.opts.linkNewTab&&!t&&(e.target=!0),this.link.setModalValues(e),this.modal.show(),this.detect.isDesktop()&&p("#redactor-link-url").focus()},linkEl:function(){var t=p(this.selection.current()).closest("a",this.core.editor()[0]);return 0!==(t=0===t.length?p(p.parseHTML(this.selection.html())).closest("a",this.core.editor()[0]):t).length&&t},setModalValues:function(t){p("#redactor-link-blank").prop("checked",t.target),p("#redactor-link-url").val(t.url),p("#redactor-link-url-text").val(t.text)},buildModal:function(t){this.modal.load("link",this.lang.get(!1===t?"link-insert":"link-edit"),600),this.modal.getActionButton().text(this.lang.get(!1===t?"insert":"save")).on("click",p.proxy(this.link.callback,this))},callback:function(){var t=this.link.buildLinkFromModal();if(!1===t)return!1;this.modal.close(),this.link.insert(t,!0)},cleanUrl:function(t){return void 0===t?"":p.trim(t.replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(t){return void 0===t?"":p.trim(t)},getText:function(t){return""===t.text&&""!==t.url?this.link.truncateUrl(t.url.replace(/<|>/g,"")):t.text},isUrl:function(t){var pattern = /^(https?|ftp|wss?|irc|skype|whatsapp|chrome|ssh):\/\/([^\s/$.?#].[^\s]*)$/i;var re3 = /\.(html|php)$/i;var re5 = /^(tel|geo|sms|magnet|skype|blob):(.*?)$/i;if (!pattern.test(t) && /^[^\s/$.?#].[^\s]*$/i.test(t) && !re3.test(t) && t.substring(0, 1) !== '/' && !re5.test(t)) {t = 'https://' + t;}if (pattern.test(t) || re3.test(t) || t.search(re5) !== -1) {return t;}return false;},isMailto:function(t){return-1!==t.search("@")&&!1===/(http|ftp|https|ssh):\/\//i.test(t)},isEmpty:function(t){return""===t.url||""===t.text&&""===t.url},truncateUrl:function(t){return t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},parse:function(t){return this.link.isMailto(t.url)?t.url="mailto:"+t.url.replace("mailto:",""):0!==t.url.search("#")&&this.opts.linkValidation&&(t.url=this.link.isUrl(t.url)),!this.link.isEmpty(t)&&!1!==t.url&&t},buildLinkFromModal:function(){var t={};return t.url=this.link.cleanUrl(p("#redactor-link-url").val()),t.text=this.link.cleanText(p("#redactor-link-url-text").val()),t.text=this.link.getText(t),t.target=!!p("#redactor-link-blank").prop("checked"),this.link.parse(t)},buildLinkFromObject:function(t,e){return e.url=this.link.cleanUrl(e.url),e.text=void 0===e.text&&this.selection.is()?this.selection.text():this.link.cleanText(e.text),e.text=this.link.getText(e),e.target=!1===t?e.target:this.link.buildTarget(t),this.link.parse(e)},buildLinkFromElement:function(t){var e={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return!1!==t&&(e.url=t.attr("href"),e.text=e.text||t.text(),e.target=this.link.buildTarget(t)),e},buildTarget:function(t){return void 0!==t.attr("target")&&"_blank"===t.attr("target")},removeSelfHostFromUrl:function(t){var e=self.location.href.replace("#","").replace(/\/$/i,"");return t.replace(/^\/\#/,"#").replace(e,"").replace("mailto:","")},replaceLinksToText:function(t){var o,e=p.each(t,function(t,e){var e=p(e),i=p('<span class="redactor-unlink" />').append(e.contents());return e.replaceWith(i),0===t&&(o=i),e});return 1===t.length&&this.selection.isCollapsed()&&this.caret.after(o),e}}},linkify:function(){return{isKey:function(t){return t===this.keyCode.ENTER||t===this.keyCode.SPACE},isLink:function(t){return t.nodeValue.match(this.opts.regexps.linkyoutube)||t.nodeValue.match(this.opts.regexps.linkvimeo)||t.nodeValue.match(this.opts.regexps.linkvimeochannel)||t.nodeValue.match(this.opts.regexps.linkimage)||t.nodeValue.match(this.opts.regexps.url)},isFiltered:function(t,e){var i;return 3===e.nodeType&&""!==(i=p.trim(e.nodeValue))&&!new RegExp("</script|style|svg>").test(i)&&!p(e).parent().is("pre")&&this.linkify.isLink(e)},handler:function(t,e){var e=p(e),i=e.text(),o=(o=i).match(this.opts.regexps.linkyoutube)||o.match(this.opts.regexps.linkvimeo)||o.match(this.opts.regexps.linkvimeochannel)?this.linkify.convertVideoLinks(o):o.match(this.opts.regexps.linkimage)?this.linkify.convertImages(o):this.linkify.convertLinks(o);e.before(i.replace(i,o)).remove()},format:function(){var i,t;this.opts.linkify&&!this.utils.isCurrentOrParent("pre")&&(this.core.editor().find(":not(iframe,img,a,pre,code,.redactor-unlink)").addBack().contents().filter(p.proxy(this.linkify.isFiltered,this)).each(p.proxy(this.linkify.handler,this)),t=this.core.editor().find(".redactor-linkify-object").each(p.proxy(function(t,e){return(i=p(e)).removeClass("redactor-linkify-object"),""===i.attr("class")&&i.removeAttr("class"),"DIV"===e.tagName?this.linkify.breakBlockTag(i,"video"):"IMG"===e.tagName?this.linkify.breakBlockTag(i,"image"):"A"===e.tagName&&this.core.callback("insertedLink",i),i},this)),setTimeout(p.proxy(function(){this.code.sync(),this.core.callback("linkify",t)},this),100))},breakBlockTag:function(t,e){var i,o=this.utils.breakBlockTag();!1!==o&&(i=t,"image"===e&&(i=p("<figure />").append(t)),"start"===o.type?o.$block.before(i):o.$block.after(i),"image"===e)&&this.caret.after(i)},convertVideoLinks:function(t){var e='<div class="'+this.opts.videoContainerClass+' redactor-linkify-object"><iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe></div>';return t=(t=(t=t.match(this.opts.regexps.linkyoutube)?t.replace(this.opts.regexps.linkyoutube,e+"//www.youtube.com/embed/$1"+i):t).match(this.opts.regexps.linkvimeo)?t.replace(this.opts.regexps.linkvimeo,e+"//player.vimeo.com/video/$2"+i):t).match(this.opts.regexps.linkvimeochannel)?t.replace(this.opts.regexps.linkvimeochannel,e+"//player.vimeo.com/video/$2"+i):t},convertImages:function(t){var e=t.match(this.opts.regexps.linkimage);return e?t.replace(t,'<img src="'+e+'" class="redactor-linkify-object" />'):t},convertLinks:function(t){var i=t.match(this.opts.regexps.url);if(i)for(var e=(i=p.grep(i,function(t,e){return p.inArray(t,i)===e})).length,o=0;o<e;o++){var s=i[o],r=s,n=null!==s.match(/(https?|ftp):\/\//i)?"":"http://",a=(-1===(r=r.length>this.opts.linkSize?r.substring(0,this.opts.linkSize)+"...":r).search("%")&&(r=decodeURIComponent(r)),"\\b"),a=(-1!==p.inArray(s.slice(-1),["/","&","="])&&(a=""),new RegExp("("+s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+a+")","g")),l="";!1!==this.opts.pasteLinkTarget&&(l=' target="'+this.opts.pasteLinkTarget+'"'),t=t.replace(a,'<a href="'+n+p.trim(s)+'"'+l+' class="redactor-linkify-object">'+p.trim(r)+"</a>")}return t}}},list:function(){return{toggle:function(t){if(!this.utils.inBlocks(["table","td","th","tr"])){var e,i,o,s,r,n,a="orderedlist"===t||"ol"===t?"OL":"UL",l=(t="OL"==a?"orderedlist":"unorderedlist",p(this.selection.current()).parentsUntil(".redactor-in","ul, ol").first()),c=p(this.selection.current()).parentsUntil(".redactor-in","li").first();if(this.placeholder.hide(),this.buffer.set(),""===this.selection.html()&&0!==c.length&&c[0].parentNode.tagName===a&&this.utils.isRedactorParent(c))return e=p(c[0]).prev(),i=p(c[0]).next(),o=c.html(),s=p(c[0].parentNode),this.selection.save(),!e.length&&i.length?(c.remove(),void s.before(p("<p />").append(o))):e.length&&i.length?(c.replaceWith(function(){return"-~=REMOVED+ITEM=~-"}),n=this.selection.current(),r=p(n)[0].outerHTML.replace(/-~=REMOVED\+ITEM=~-/g,"</"+a+">\n\n<p>"+o+"</p>\n\n<"+a+">"),p(n).replaceWith(function(){return r})):e.length&&!i.length?(c.remove(),void s.after(p("<p />").append(o))):void(e.length||i.length||s.replaceWith(function(){return p("<p />").append(o)}));0!==l.length&&l[0].tagName===a&&this.utils.isRedactorParent(l)?(this.selection.save(),l.find("ul, ol").each(function(){var t=p(this).closest("li");p(this).find("li").each(function(){p(t).after(this)})}),l.find("ul, ol").remove(),l.find("li").each(function(){return p(this).replaceWith(function(){return p("<p />").append(p(this).contents())})}),l.replaceWith(function(){return p(this).contents()}),this.selection.restore()):(this.selection.save(),0!==l.length&&l[0].tagName!==a?l.each(p.proxy(function(t,e){this.utils.replaceToTag(e,a)},this)):document.execCommand("insert"+t),this.selection.restore(),(n=this.list.get())?(n.find("span").replaceWith(function(){return p(this).contents()}),n.find(this.opts.inlineTags.join(",")).each(function(){p(this).removeAttr("style")}),c=n.parent(),this.utils.isRedactorParent(c)&&"LI"!==c[0].tagName&&this.utils.isBlock(c)&&(this.selection.save(),c.replaceWith(c.contents()),this.selection.restore())):this.selection.block()||document.execCommand("formatblock",!1,"p"))}},get:function(){var t=this.selection.current(),t=p(t).closest("ul, ol",this.core.editor()[0]);return 0!==t.length&&t},combineAfterAndBefore:function(t){var e=p(t).prev(),i=p(t).next(),t=t&&"P"===t.tagName&&("<br>"===t.innerHTML||""===t.innerHTML),o=1===e.closest("ol, ul",this.core.editor()[0]).length&&1===i.closest("ol, ul",this.core.editor()[0]).length;return!(!t||!o||(e.children("li").last().append(this.marker.get()),e.append(i.contents()),this.selection.restore(),0))}}},marker:function(){return{get:function(t){t=void 0===t?1:t;var e=document.createElement("span");return e.id="selection-marker-"+t,e.className="redactor-selection-marker",e.innerHTML=this.opts.invisibleSpace,e},html:function(t){return this.utils.getOuterHtml(this.marker.get(t))},find:function(t){return t=void 0===t?1:t,this.core.editor().find("span#selection-marker-"+t)},insert:function(){var t=this.selection.get(),t=this.selection.range(t);this.marker.insertNode(t,this.marker.get(1),!0),t&&!1===t.collapsed&&this.marker.insertNode(t,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(t,e,i){var o=this.selection.parent();if(null!==t&&0!==p(o).closest(".redactor-in").length){t=t.cloneRange();try{t.collapse(i),t.insertNode(e)}catch(t){this.focus.start()}}},iterateRemove:function(t,e){var e=p(e),i=e.text().replace(/\u200B/g,"");e.parent()[0];""===i?e.remove():e.replaceWith(function(){return p(this).contents()})}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":String()+'<div class="redactor-modal-tab redactor-group" data-title="'+this.lang.get("general")+'"><div id="redactor-image-preview" class="redactor-modal-tab-side"></div><div class="redactor-modal-tab-area"><section><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /></section><section><label>'+this.lang.get("caption")+'</label><input type="text" id="redactor-image-caption" aria-label="'+this.lang.get("caption")+'" /></section><section><label>'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" aria-label="'+this.lang.get("link")+'" /></section><section><label class="redactor-image-position-option">'+this.lang.get("image-position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image-position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+'</option></select></section><section><label class="checkbox"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link-in-new-tab")+'"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+'</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">'+this.lang.get("delete")+"</button></section></div></div>",image:String()+'<div class="redactor-modal-tab" data-title="'+this.lang.get("upload")+'"><section><div id="redactor-modal-image-droparea"></div></section></div>',file:String()+'<div class="redactor-modal-tab" data-title="'+this.lang.get("upload")+'"><section><label>'+this.lang.get("filename")+' <span class="desc">('+this.lang.get("optional")+')</span></label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br></section><section><div id="redactor-modal-file-upload"></div></section></div>',link:String()+'<div class="redactor-modal-tab" data-title="'+this.lang.get("general")+'"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},p.extend(this.opts,this.opts.modal)},addCallback:function(t,e){this.modal.callbacks[t]=e},addTemplate:function(t,e){this.opts.modal[t]=e},getTemplate:function(t){return this.opts.modal[t]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(t,e,i){void 0!==this.$modalBox&&this.$modalBox.hasClass("open")||(this.modal.templateName=t,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(e),this.modal.setDraggable(),this.modal.setContent(),void 0!==this.modal.callbacks[t]&&this.modal.callbacks[t].call(this))},show:function(){this.detect.isDesktop()||document.activeElement.blur(),this.selection.save(),this.modal.buildTabber(),this.detect.isMobile()&&(this.modal.width="96%"),setTimeout(p.proxy(this.modal.buildWidth,this),0),p(window).on("resize.redactor-modal",p.proxy(this.modal.buildWidth,this)),this.$modalOverlay.redactorAnimation("fadeIn",{duration:.25}),this.$modalBox.addClass("open").show(),this.$modal.redactorAnimation("fadeIn",{timing:"cubic-bezier(0.175, 0.885, 0.320, 1.105)"},p.proxy(function(){this.utils.saveScroll(),this.utils.disableBodyScroll(),this.core.callback("modalOpened",this.modal.templateName,this.$modal),p(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",p.proxy(this.modal.setEnter,this))},this))},buildWidth:function(){var t=p(window).height(),e=p(window).width(),i="number"==typeof this.modal.width,e=(!i&&this.modal.width.match(/%$/)?this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}):parseInt(this.modal.width)>e?this.$modal.css({width:"96%","margin-bottom":"2%"}):(i&&(this.modal.width+="px"),this.$modal.css({width:this.modal.width,"margin-bottom":"16px"})),this.$modal.outerHeight()),i=t/2-e/2+"px";this.detect.isMobile()?i="2%":t<e&&(i="16px"),this.$modal.css("margin-top",i)},buildTabber:function(){this.modal.tabs=this.$modal.find(".redactor-modal-tab"),this.modal.tabs.length<2||(this.modal.$tabsBox=p('<div id="redactor-modal-tabber" />'),p.each(this.modal.tabs,p.proxy(function(t,e){e=p('<a href="#" rel="'+t+'" />').text(p(e).attr("data-title"));e.on("click",p.proxy(this.modal.showTab,this)),0===t&&e.addClass("active"),this.modal.$tabsBox.append(e)},this)),this.$modalBody.prepend(this.modal.$tabsBox))},showTab:function(t){t.preventDefault();var t=p(t.target),e=t.attr("rel");return this.modal.tabs.hide(),this.modal.tabs.eq(e).show(),p("#redactor-modal-tabber").find("a").removeClass("active"),t.addClass("active"),!1},setTitle:function(t){this.$modalHeader.html(t)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",p.proxy(this.modal.close,this))},setDraggable:function(){void 0!==p.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(t){13===t.which&&(t.preventDefault(),this.modal.getActionButton().click())},build:function(){this.modal.buildOverlay(),this.$modalBox=p('<div id="redactor-modal-box"/>').hide(),this.$modal=p('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=p('<div id="redactor-modal-header" />'),this.$modalClose=p('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=p('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=p('<div id="redactor-modal-overlay">').hide(),p("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("mousedown.redactor-modal",p.proxy(this.modal.close,this)),p(document).on("keyup.redactor-modal",p.proxy(this.modal.closeHandler,this)),this.core.editor().on("keyup.redactor-modal",p.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",p.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("mousedown.redactor-modal"),p(document).off("keyup.redactor-modal"),this.core.editor().off("keyup.redactor-modal"),this.$modalBox.off("click§.redactor-modal"),p(window).off("resize.redactor-modal")},closeHandler:function(t){t.which===this.keyCode.ESC&&this.modal.close(!1)},close:function(t){if(t){if("redactor-modal-button-cancel"!==p(t.target).attr("id")&&t.target!==this.$modalClose[0]&&t.target!==this.$modalBox[0])return;t.preventDefault()}this.$modalBox&&(this.selection.restore(),this.modal.disableEvents(),this.utils.enableBodyScroll(),this.utils.restoreScroll(),this.$modalOverlay.redactorAnimation("fadeOut",{duration:.4},p.proxy(function(){this.$modalOverlay.remove()},this)),this.$modal.redactorAnimation("fadeOut",{duration:.3,timing:"cubic-bezier(0.175, 0.885, 0.320, 1.175)"},p.proxy(function(){void 0!==this.$modalBox&&(this.$modalBox.remove(),this.$modalBox=void 0),this.core.callback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){void 0===this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(t,e){return(e=void 0===e?p(this.selection.current()):e).is(t)||0<e.parents(t).length},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(t,e){var s=this.selection.current(),r=this.selection.parent();!1!==t?this.button.setInactiveAll():this.button.setInactiveAll(e),!1===t&&"html"!==e?-1!==p.inArray(e,this.opts.activeButtons)&&this.button.toggleActive(e):this.utils.isRedactorParent(s)&&("none"!==this.core.editor().css("display")&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule")),p.each(this.opts.activeButtonsStates,p.proxy(function(t,e){var i=p(r).closest(t,this.$editor[0]),o=p(s).closest(t,this.$editor[0]);0!==i.length&&!this.utils.isRedactorParent(i)||!this.utils.isRedactorParent(o)||0===i.length&&0===o.closest(t,this.$editor[0]).length||this.button.setActive(e)},this)))},dropdowns:function(){var r=p("<div />").html(this.selection.html()).find("a").length,n=p(this.selection.current()),a=this.utils.isRedactorParent(n);p.each(this.opts.observe.dropdowns,p.proxy(function(t,e){var i=e.observe,o=i.element,e=e.item,s=void 0!==i.in&&i.in,i=void 0!==i.out&&i.out;0<n.closest(o).length&&a||"a"===o&&0!==r?this.observe.setDropdownProperties(e,s,i):this.observe.setDropdownProperties(e,i,s)},this))},setDropdownProperties:function(t,e,i){i&&void 0!==i.attr&&this.observe.setDropdownAttr(t,i.attr,!0),void 0!==e.attr&&this.observe.setDropdownAttr(t,e.attr),void 0!==e.title&&t.find("span").text(e.title)},setDropdownAttr:function(i,t,o){p.each(t,function(t,e){"class"===t?o?i.removeClass(e):i.addClass(e):o?i.removeAttr(t):i.attr(t,e)})},addDropdown:function(t,e,i){void 0!==i.observe&&(i.item=t,this.opts.observe.dropdowns.push(i))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-layer-img-edit"),this.core.editor().find("img").each(p.proxy(function(t,e){e=p(e);e.closest("a",this.$editor[0]).on("click",function(t){t.preventDefault()}),this.image.setEditable(e)},this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each(p.proxy(function(t,e){e=p(e);!0!==e.data("cached")&&(e.data("cached",!0),e.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.showTooltip,this)))},this))},getTooltipPosition:function(t){return t.offset()},showTooltip:function(t){var e,i,o,s,r,n=p(t.target);"IMG"!==n[0].tagName&&"A"===(n="A"!==n[0].tagName?n.closest("a",this.$editor[0]):n)[0].tagName&&(n=n,e=this.observe.getTooltipPosition(n),i=p('<span class="redactor-link-tooltip"></span>'),24<(o=void 0===(o=n.attr("href"))?"":o).length&&(o=o.substring(0,24)+"..."),o=p('<a href="'+n.attr("href")+'" target="_blank" />').html(o).addClass("redactor-link-tooltip-action"),s=p('<a href="#" />').html(this.lang.get("edit")).on("click",p.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),r=p('<a href="#" />').html(this.lang.get("unlink")).on("click",p.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action"),i.append(o).append(" | ").append(s).append(" | ").append(r),o=parseInt(n.css("line-height"),10),s=Math.ceil((t.pageY-e.top)/o),r=e.top+s*o,i.css({top:r+"px",left:e.left+"px"}),p(".redactor-link-tooltip").remove(),p("body").append(i),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.closeTooltip,this)),p(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.closeTooltip,this)))},closeAllTooltip:function(){p(".redactor-link-tooltip").remove()},closeTooltip:function(t){var t=(t=t.originalEvent||t).target,e=p(t).closest("a",this.$editor[0]);0!==e.length&&"A"===e[0].tagName&&"A"!==t.tagName||"A"===t.tagName&&this.utils.isRedactorParent(t)||p(t).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.closeTooltip,this)),p(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(t){var e,t=this.offset.clone(t);return!1===t?0:((e=document.createElement("div")).appendChild(t.cloneContents()),e.innerHTML=e.innerHTML.replace(/<img(.*?[^>])>$/gi,"i"),p.trim(p(e).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"").length)},clone:function(t){var e=this.selection.get(),e=this.selection.range(e);if(null===e&&void 0===t)return!1;if(!1===(t=void 0===t?this.$editor:t))return!1;t=t[0]||t;var i=e.cloneRange();return i.selectNodeContents(t),i.setEnd(e.endContainer,e.endOffset),i},set:function(t,e){e=void 0===e?t:e,this.focus.is()||this.focus.start();for(var i,o=this.selection.get(),s=this.selection.range(o),r=0,n=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(i=n.nextNode());)if(t<(r+=i.nodeValue.length)&&(s.setStart(i,i.nodeValue.length+t-r),t=1/0),e<=r){s.setEnd(i,i.nodeValue.length+e-r);break}s.collapse(!1),this.selection.update(o,s)}}},paragraphize:function(){return{load:function(t){return!1===this.opts.paragraphize||"inline"===this.opts.type||"pre"===this.opts.type?t:""===t||"<p></p>"===t?this.opts.emptyHtml:(t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=(t=(t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")).replace(/<\/pre>/gi,"</pre>\n\n")).replace(/<p>\s<br><\/p>/gi,"<p></p>"),t=(t=this.paragraphize.getSafes(t)).replace("<br>","\n"),t=this.paragraphize.convert(t),t=this.paragraphize.clear(t),t=(t=this.paragraphize.restoreSafes(t)).replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),p.trim(t))},getSafes:function(t){t=p("<div />").append(t);return t.find("blockquote p").replaceWith(function(){return p(this).append("<br />").contents()}),t.find(this.opts.paragraphizeBlocks.join(", ")).each(p.proxy(function(t,e){e&&e.tagName&&"iframe"==e.tagName.toLowerCase()&&(e.innerHTML="");var i=e.outerHTML;if(e&&e.tagName)switch(e.tagName.toLowerCase()){case"ul":case"ol":i=(i=(i=i.replace(new RegExp("(<brs*?>s*)*<li>(s*<brs*?>)*","gi"),"\n<li>")).replace(new RegExp("(<brs*?>s*)*</ul>","gi"),"\n</ul>\n")).replace(new RegExp("(<brs*?>s*)*</ol>","gi"),"\n</ol>\n");break;case"table":i=(i=(i=(i=i.replace(new RegExp("(<brs*?>s*)*<(tr|td|tbody)>(s*<brs*?>)*","gi"),"\n<$2>")).replace(new RegExp("(<brs*?>s*)*</table>","gi"),"\n</table>\n")).replace(new RegExp("(<brs*?>s*)*</tbody>","gi"),"\n</tbody>")).replace(new RegExp("(<brs*?>s*)*</tr>","gi"),"\n</tr>")}return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i,p(e).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),t.find("span.redactor-selection-marker").each(p.proxy(function(t,e){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=e.outerHTML,p(e).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),t.html()},restoreSafes:function(i){return p.each(this.paragraphize.safes,function(t,e){e=void 0!==e?e.replace(/\$/g,"&#36;"):e,i=i.replace("#####replace"+t+"#####",e)}),i},convert:function(t){t=(t=(t=(t=t.replace(/\r\n/g,"xparagraphmarkerz")).replace(/\n/g,"xparagraphmarkerz")).replace(/\r/g,"xparagraphmarkerz")).replace(/\s+/g," ");return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t="<p>"+(t=(t=(t=p.trim(t)).replace(/xparagraphmarkerzxparagraphmarkerz/gi,"</p><p>")).replace(/xparagraphmarkerz/gi,"<br>"))+"</p>").replace("<p></p>","")).replace("\r\n\r\n","")).replace(/<\/p><p>/g,"</p>\r\n\r\n<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>/gi,"<p>")},clear:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####")).replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>")).replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(t){this.rtePaste=!0;var o=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(t)?this.detect.isIe()&&setTimeout(p.proxy(this.paste.clipboardUpload,this),100):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(o),p(window).on("scroll.redactor-freeze",p.proxy(function(){p(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(p.proxy(function(){var t=this.paste.getPasteBoxCode(o),e=(this.buffer.set(),this.selection.restore(),this.utils.restoreScroll(),this.clean.getCurrentType(t)),t=this.clean.onPaste(t,e),i=this.core.callback("paste",t);this.paste.insert(void 0===i?t:i,e),this.rtePaste=!1,o&&this.clean.cleanPre(),p(window).off("scroll.redactor-freeze")},this),1))},getPasteBoxCode:function(t){t=t?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),t},createPasteBox:function(t){var e={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=(t?p("<textarea>"):p("<div>").attr("contenteditable","true")).css(e),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){var t;this.detect.isIe()?this.core.box().append(this.$pasteBox):0<(t=p(".modal-body:visible")).length?t.append(this.$pasteBox):p("body").prepend(this.$pasteBox)},detectClipboardUpload:function(t){var e=(t=t.originalEvent||t).clipboardData;return!this.detect.isIe()&&!this.detect.isFirefox()&&(-1!==e.types.indexOf("public.tiff")?(t.preventDefault(),!1):e.items&&e.items.length?(this.opts.imageUpload&&e.items[0].type.includes("image")&&t.preventDefault(),null!==(t=e.items[0].getAsFile())&&((e=new FileReader).readAsDataURL(t),e.onload=p.proxy(this.paste.insertFromClipboard,this),!0)):void 0)},clipboardUpload:function(){var t=this.$editor.find("img");p.each(t,p.proxy(function(t,i){var e,o;-1!==i.src.search(/^data\:image/i)&&(e=window.FormData?new FormData:null,window.FormData)&&(this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=p.proxy(function(t){var e;this.detect.isIe()?p(i).wrap(p("<figure />")):(e=p(i).parent(),this.utils.replaceToTag(e,"figure"),this.caret.after(p(i).parent())),i.src=t.url,this.core.callback("imageUpload",p(i),t)},this),o=this.utils.dataURItoBlob(i.src),e.append("clipboard",1),e.append(this.opts.imageUploadParam,o,this.paste.getImageNameWithExt(o)||"blob"),this.progress.show(),this.upload.send(e,!1),this.code.sync(),this.rtePaste=!1)},this))},insertFromClipboard:function(t){var e,i=window.FormData?new FormData:null;window.FormData&&(this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert,e=this.utils.dataURItoBlob(t.target.result),i.append("clipboard",1),i.append(this.opts.imageUploadParam,e,this.paste.getImageNameWithExt(e)||"blob"),this.progress.show(),this.upload.send(i,t),this.rtePaste=!1)},insert:function(t,e){e.pre?this.insert.raw(t):e.text?this.insert.text(t):this.insert.html(t,e),this.detect.isFirefox()&&this.opts.imageUpload&&this.opts.clipboardImageUpload&&setTimeout(p.proxy(this.paste.clipboardUpload,this),100)},getImageNameWithExt:function(t){var e=null;return e=t.type.includes("image")?"image."+String(t.type).replace("image/",""):e}}},placeholder:function(){return{enable:function(){setTimeout(p.proxy(function(){return this.placeholder.isEditorEmpty()?this.placeholder.show():this.placeholder.hide()},this),this.detect.isMobile()&&this.detect.isSafari()?50:5)},show:function(){this.core.editor().addClass("redactor-placeholder")},update:function(t){this.opts.placeholder=t,this.core.editor().attr("placeholder",t)},hide:function(){this.core.editor().removeClass("redactor-placeholder")},is:function(){return this.core.editor().hasClass("redactor-placeholder")},init:function(){this.placeholder.enabled()&&(this.utils.isEditorRelative()||this.utils.setEditorRelative(),this.placeholder.build(),this.placeholder.buildPosition(),this.placeholder.enable(),this.placeholder.enableEvents())},enabled:function(){return this.opts.placeholder?this.core.element().attr("placeholder",this.opts.placeholder):this.placeholder.isAttr()},enableEvents:function(){this.core.editor().on("keydown.redactor-placeholder."+this.uuid,p.proxy(this.placeholder.enable,this))},disableEvents:function(){this.core.editor().off(".redactor-placeholder."+this.uuid)},build:function(){this.core.editor().attr("placeholder",this.core.element().attr("placeholder"))},buildPosition:function(){var t=p("<style />");t.addClass("redactor-placeholder-style-tag"),t.html("#"+this.core.id()+".redactor-placeholder::after "+this.placeholder.getPosition()),p("head").append(t)},getPosition:function(){return"{ top: "+this.core.editor().css("padding-top")+"; left: "+this.core.editor().css("padding-left")+"; }"},isEditorEmpty:function(){var t=p.trim(this.core.editor().html()).replace(/[\t\n]/g,""),e=["","<p>​</p>","<p>​<br></p>",this.opts.emptyHtmlRendered];return-1!==p.inArray(t,e)},isAttr:function(){return void 0!==this.core.element().attr("placeholder")&&""!==this.core.element().attr("placeholder")},destroy:function(){this.core.editor().removeAttr("placeholder"),this.placeholder.hide(),this.placeholder.disableEvents(),p(".redactor-placeholder-style-tag").remove()}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){this.progress.is()?this.progress.$box.show():(this.progress.build(),this.progress.$box.redactorAnimation("fadeIn"))},hide:function(){this.progress.is()&&this.progress.$box.redactorAnimation("fadeOut",{duration:.35},p.proxy(this.progress.destroy,this))},update:function(t){this.progress.show(),this.progress.$bar.css("width",t+"%")},is:function(){return null!==this.progress.$box},build:function(){this.progress.$bar=p("<span />"),this.progress.$box=p('<div id="redactor-progress" />'),this.progress.$box.append(this.progress.$bar),p(this.progress.target).append(this.progress.$box)},destroy:function(){this.progress.is()&&this.progress.$box.remove(),this.progress.$box=null,this.progress.$bar=null}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(t){return(t=void 0===t?this.selection.get():t).getRangeAt&&t.rangeCount?t.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var t=this.selection.range();if(null!==t){t=t.startContainer.parentNode;if(p(t).hasClass("redactor-in")||0!==p(t).parents(".redactor-in").length)return!0}return!1},isCollapsed:function(){var t=this.selection.get();return null!==t&&t.isCollapsed},update:function(t,e){null!==e&&(t.removeAllRanges(),t.addRange(e))},current:function(){var t=this.selection.get();return null!==t&&t.anchorNode},parent:function(){var t=this.selection.current();return null!==t&&t.parentNode},block:function(t){for(t=t||this.selection.current();t;){if(this.utils.isBlockTag(t.tagName))return!p(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},inline:function(t){for(t=t||this.selection.current();t;){if(this.utils.isInlineTag(t.tagName))return!p(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},element:function(t){for(t=t||this.selection.current();t;){if(1===t.nodeType)return!p(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},prev:function(){return null!==this.selection.current()&&this.selection.current().previousSibling},next:function(){return null!==this.selection.current()&&this.selection.current().nextSibling},blocks:function(t){var i=[],t=this.selection.nodes(t),t=(p.each(t,p.proxy(function(t,e){this.utils.isBlock(e)&&i.push(e)},this)),this.selection.block());return 0===i.length&&!1===t?[]:0===i.length&&!1!==t?[t]:i},inlines:function(t){var i=[],t=this.selection.nodes(t),t=(p.each(t,p.proxy(function(t,e){this.utils.isInline(e)&&i.push(e)},this)),this.selection.inline());return 0===i.length&&!1===t?[]:0===i.length&&!1!==t?[t]:i},nodes:function(t){var o=void 0===t?[]:p.isArray(t)?t:[t],t=this.selection.get(),e=this.selection.range(t),i=[],s=[];if(this.utils.isCollapsed())i=[this.selection.current()];else{var r=e.startContainer,n=e.endContainer;if(r===n)return[this.selection.parent()];for(;r&&r!==n;)((r=this.selection.nextNode(r))!==n||0<e.endOffset)&&i.push(r);for(r=e.startContainer;r&&r!==e.commonAncestorContainer;)i.unshift(r),r=r.parentNode}return p.each(i,function(t,e){var i;e&&(i=1===e.nodeType&&e.tagName.toLowerCase(),p(e).hasClass("redactor-script-tag")||p(e).hasClass("redactor-selection-marker")||i&&0!==o.length&&-1===p.inArray(i,o)||s.push(e))}),0===s.length?[]:s},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(t){var e=this.marker.find(1),i=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==e.length&&0!==i.length?this.caret.set(e,i):0!==e.length?this.caret.start(e):this.core.editor().focus(),!1!==t&&(this.marker.remove(),this.savedSel=!1)},saveInstant:function(){var t,e=this.core.editor()[0],i=e.ownerDocument.defaultView.getSelection();if(i.getRangeAt&&i.rangeCount)return(t=(i=i.getRangeAt(0)).cloneRange()).selectNodeContents(e),t.setEnd(i.startContainer,i.startOffset),e=t.toString().length,this.saved={start:e,end:e+i.toString().length,node:i.startContainer},this.saved},restoreInstant:function(t){if(void 0!==t||this.saved){this.saved=void 0!==t?t:this.saved;t=this.core.editor().find(this.saved.node);if(0!==t.length&&0===t.text().trim().replace(/\u200B/g,"").length)try{(e=document.createRange()).setStart(t[0],0),(o=window.getSelection()).removeAllRanges(),o.addRange(e)}catch(t){}else{for(var e,i,o,t=this.core.editor()[0],s=t.ownerDocument,r=s.defaultView,n=0,a=((e=s.createRange()).setStart(t,0),e.collapse(!0),[t]),l=!1,c=!1;!c&&(i=a.pop());)if(3==i.nodeType){var d=n+i.length;!l&&this.saved.start>=n&&this.saved.start<=d&&(e.setStart(i,this.saved.start-n),l=!0),l&&this.saved.end>=n&&this.saved.end<=d&&(e.setEnd(i,this.saved.end-n),c=!0),n=d}else for(var h=i.childNodes.length;h--;)a.push(i.childNodes[h]);(o=r.getSelection()).removeAllRanges(),o.addRange(e)}}},node:function(t){p(t).prepend(this.marker.get(1)),p(t).append(this.marker.get(2)),this.selection.restore()},all:function(){this.core.editor().focus();var t=this.selection.get(),e=this.selection.range(t);e.selectNodeContents(this.core.editor()[0]),this.selection.update(t,e)},remove:function(){this.selection.get().removeAllRanges()},replace:function(t){this.insert.html(t)},text:function(){return this.selection.get().toString()},html:function(){var t="",e=this.selection.get();if(e.rangeCount){for(var i=document.createElement("div"),o=e.rangeCount,s=0;s<o;++s)i.appendChild(e.getRangeAt(s).cloneContents());t=this.clean.onGet(i.innerHTML)}return t},extractEndOfNode:function(t){var e=this.selection.get(),e=this.selection.range(e),i=e.cloneRange();return i.selectNodeContents(t),i.setStart(e.endContainer,e.endOffset),i.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(t){return this.marker.get(t)},markerHtml:function(t){return this.marker.html(t)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(i,t){if(!1===this.opts.shortcuts)return!i.ctrlKey&&!i.metaKey||66!==t&&73!==t||i.preventDefault(),!1;p.each(this.opts.shortcuts,p.proxy(function(t,e){this.shortcuts.build(i,t,e)},this))},build:function(t,e,i){for(var o=p.proxy(function(){this.shortcuts.buildHandler(i)},this),s=e.split(","),r=s.length,n=0;n<r;n++)"string"==typeof s[n]&&this.shortcuts.handler(t,p.trim(s[n]),o)},buildHandler:function(t){var e;"-1"!==t.func.search(/\./)?void 0!==this[(e=t.func.split("."))[0]]&&this[e[0]][e[1]].apply(this,t.params):this[t.func].apply(this,t.params)},handler:function(i,t,e){t=t.toLowerCase().split(" ");for(var o=this.shortcuts.hotkeysSpecialKeys[i.keyCode],s=String.fromCharCode(i.which).toLowerCase(),r="",n={},a=(p.each(["alt","ctrl","meta","shift"],function(t,e){i[e+"Key"]&&o!==e&&(r+=e+"+")}),o&&(n[r+o]=!0),s&&(n[r+s]=!0,n[r+this.shortcuts.hotkeysShiftNums[s]]=!0,"shift+"===r)&&(n[this.shortcuts.hotkeysShiftNums[s]]=!0),t.length),l=0;l<a;l++)if(n[t[l]])return i.preventDefault(),e.apply(this,arguments)}}},storage:function(){return{data:[],add:function(t){t.status=!0,t.url=decodeURI(t.url),this.storage.data[t.url]=t},status:function(t,e){this.storage.data[decodeURI(t)].status=e},observe:function(){var o=this;this.core.editor().find("[data-image]").each(function(t,e){o.storage.add({type:"image",node:e,url:e.src,id:p(e).attr("data-image")})}),this.core.editor().find("[data-file]").each(function(t,e){o.storage.add({type:"file",node:e,url:e.href,id:p(e).attr("data-file")})}),this.core.editor().find("[data-s3]").each(function(t,e){var i="IMG"===e.tagName?e.src:e.href;o.storage.add({type:"s3",node:e,url:i,id:p(e).attr("data-s3")})})},changes:function(){for(var t in this.storage.data){var t=this.storage.data[t],e="IMG"===t.node.tagName?"src":"href";0===this.core.editor().find("[data-"+t.type+"]["+e+'="'+t.url+'"]').length?this.storage.status(t.url,!1):this.storage.status(t.url,!0)}return this.storage.data}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbarBox=p("<div />").addClass("redactor-toolbar-box"),this.$toolbar=this.toolbar.createContainer(),this.$toolbarBox.append(this.$toolbar),this.toolbar.append(),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),this.toolbar.setOverflow(),this.toolbar.setFixed()},createContainer:function(){return p("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),p(this.opts.toolbarExternal).html(this.$toolbarBox)):"textarea"===this.opts.type?this.$box.prepend(this.$toolbarBox):this.$element.before(this.$toolbarBox)},setOverflow:function(){this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},setFixed:function(){var t;this.opts.toolbarFixed&&!this.opts.toolbarExternal&&(this.opts.toolbarFixedTarget!==document&&(t=p(this.opts.toolbarFixedTarget),this.toolbar.toolbarOffsetTop=0===t.length?0:this.core.box().offset().top-t.offset().top),t=0!==this.core.box().closest(".modal-body").length?1e3:0,setTimeout(p.proxy(function(){var t=this;this.toolbar.observeScroll(!1),this.detect.isDesktop()?p(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){t.core.editor().height()<100||t.placeholder.isEditorEmpty()||t.toolbar.observeScroll()}):p(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){t.core.editor().height()<100||t.placeholder.isEditorEmpty()||(t.core.toolbar().hide(),clearTimeout(p.data(this,"scrollCheck")),p.data(this,"scrollCheck",setTimeout(function(){t.core.toolbar().show(),t.toolbar.observeScroll()},250)))})},this),t))},setUnfixed:function(){this.toolbar.observeScrollDisable()},getBoxTop:function(){return this.opts.toolbarFixedTarget===document?this.core.box().offset().top:this.toolbar.toolbarOffsetTop},observeScroll:function(t){var e=0,t=(!1!==t&&(e=this.opts.toolbarFixedTarget===document?20:0),p(this.opts.toolbarFixedTarget).scrollTop()),i=this.toolbar.getBoxTop();t!==i&&(t+this.opts.toolbarFixedTopOffset+e>i?this.toolbar.observeScrollEnable(t,i):this.toolbar.observeScrollDisable())},observeScrollResize:function(){this.$toolbar.css({width:this.core.box().innerWidth(),left:this.core.box().offset().left})},observeScrollEnable:function(t,e){var i,o,s,r,n;void 0!==this.fullscreen&&!1===this.fullscreen.isOpened?this.toolbar.observeScrollDisable():(i=e+this.core.box().outerHeight()-32,o=this.core.box().innerWidth(),s=this.detect.isDesktop()?"fixed":"absolute",r=this.detect.isDesktop()?this.opts.toolbarFixedTopOffset:p(this.opts.toolbarFixedTarget).scrollTop()-e+this.opts.toolbarFixedTopOffset,n=this.detect.isDesktop()?this.core.box().offset().left:0,this.opts.toolbarFixedTarget!==document&&(s="absolute",r=this.opts.toolbarFixedTopOffset+p(this.opts.toolbarFixedTarget).scrollTop()-e,n=0),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:s,width:o,top:r,left:n}),i<t&&p(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",t<i?"visible":"hidden"),p(window).on("resize.redactor-toolbar."+this.uuid,p.proxy(this.toolbar.observeScrollResize,this)))},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box"),p(window).off("resize.redactor-toolbar."+this.uuid)},setDropdownsFixed:function(){var t=this.opts.toolbarFixedTarget===document&&this.detect.isDesktop()?"fixed":"absolute";this.toolbar.setDropdownPosition(t)},unsetDropdownsFixed:function(){this.toolbar.setDropdownPosition("absolute")},setDropdownPosition:function(o){var s=this;p(".redactor-dropdown-"+this.uuid).each(function(){var t=p(this),e=s.button.get(t.attr("rel")),i="fixed"===o?s.opts.toolbarFixedTopOffset:e.offset().top;t.css({position:o,top:e.innerHeight()+i+"px"})})}}},upload:function(){return{init:function(t,e,i){this.upload.direct=!1,this.upload.callback=i,this.upload.url=e,this.upload.$el=p(t),this.upload.$droparea=p('<div id="redactor-droparea" />'),this.upload.$placeholdler=p('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload-label")),this.upload.$input=p('<input type="file" name="file" multiple />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",p.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",p.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",p.proxy(function(t){t=t.originalEvent||t;for(var e=this.upload.$input[0].files.length,i=0;i<e;i++)this.upload.traverseFile(this.upload.$input[0].files[e-1-i],t)},this)),this.upload.$droparea.on("drop.redactor.upload",p.proxy(function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(t)},this))},directUpload:function(t,e){this.upload.direct=!0,this.upload.traverseFile(t,e)},onDrop:function(t){var e=(t=t.originalEvent||t).dataTransfer.files;if(this.opts.multipleImageUpload)for(var i=e.length,o=0;o<i;o++)this.upload.traverseFile(e[o],t);else this.upload.traverseFile(e[0],t)},traverseFile:function(t,e){if(this.opts.s3)return this.upload.setConfig(t),this.upload.url?void this.uploads3.send(t,e):void 0;var i=window.FormData?new FormData:null;if(window.FormData){if(this.upload.setConfig(t),!this.upload.url)return;var o="image"===this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(o,t)}this.progress.show(),!1!==this.core.callback("uploadStart",e,i)&&this.upload.send(i,e)},setConfig:function(t){this.upload.getType(t),this.upload.direct&&(this.upload.url="image"===this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback=("image"===this.upload.type?this.image:this.file).insert)},getType:function(t){this.upload.type=-1===this.opts.imageTypes.indexOf(t.type)?"file":"image",null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(t,i){return!1!==t&&"object"==typeof t&&p.each(t,p.proxy(function(t,e){null!==e&&0===e.toString().indexOf("#")&&(e=p(e).val()),i.append(t,e)},this)),i},send:function(t,i){t="image"===this.upload.type?(t=this.utils.appendFields(this.opts.imageUploadFields,t),t=this.utils.appendForms(this.opts.imageUploadForms,t),this.upload.getHiddenFields(this.upload.imageFields,t)):(this.opts.fileUploadFields||(this.opts.fileUploadFields={}),!this.opts.fileUploadFields._csrf&&this.opts.imageUploadFields&&this.opts.imageUploadFields._csrf&&(this.opts.fileUploadFields._csrf=this.opts.imageUploadFields._csrf),t=this.utils.appendFields(this.opts.fileUploadFields,t),t=this.utils.appendForms(this.opts.fileUploadForms,t),this.upload.getHiddenFields(this.upload.fileFields,t));var o=new XMLHttpRequest;o.open("POST",this.upload.url),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.onreadystatechange=p.proxy(function(){if(4===o.readyState){var e,t=o.responseText;t=(t=t.replace(/^\[/,"")).replace(/\]$/,"");try{e="string"==typeof t?JSON.parse(t):t}catch(t){e={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),"object"==typeof e&&e&&"fail"===e.status||this.upload.callback(e,this.upload.direct,i)}},this),!1!==this.core.callback("uploadBeforeSend",o)&&o.send(t)},onDrag:function(t){t.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(t,e){this.upload.imageFields[t]=e},removeImageFields:function(t){delete this.upload.imageFields[t]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(t,e){this.upload.fileFields[t]=e},removeFileFields:function(t){delete this.upload.fileFields[t]}}},uploads3:function(){return{send:function(e,i){this.uploads3.executeOnSignedUrl(e,p.proxy(function(t){this.uploads3.sendToS3(e,t,i)},this))},executeOnSignedUrl:function(t,e){var i=new XMLHttpRequest,o=-1===this.opts.s3.search(/\?/)?"?":"&",s=(i.open("GET",this.opts.s3+o+"name="+t.name+"&type="+t.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),this);i.onreadystatechange=function(t){4===this.readyState&&200===this.status&&(s.progress.show(),e(decodeURIComponent(this.responseText)))},i.send()},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=null,i},sendToS3:function(t,i,o){var s=this.uploads3.createCORSRequest("PUT",i);s&&(s.onload=p.proxy(function(){var t;if(this.progress.hide(),200!==s.status)this.upload.callback(t={error:!0},this.upload.direct,s);else{var e=i.split("?");if(!e[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),t={url:e[0],id:e[0],s3:!0},"file"===this.upload.type&&(e=e[0].split("/"),t.name=e[e.length-1]),this.upload.callback(t,this.upload.direct,o)}},this),s.onerror=function(){},s.upload.onprogress=function(t){},s.setRequestHeader("Content-Type",t.type),s.setRequestHeader("x-amz-acl","public-read"),s.send(t))}}},utils:function(){return{isEmpty:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=void 0===t?this.core.editor().html():t).replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),""===(t=p.trim(t))},isElement:function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},strpos:function(t,e,i){t=t.indexOf(e,i);return 0<=t&&t},dataURItoBlob:function(t){for(var e=(0<=t.split(",")[0].indexOf("base64")?atob:unescape)(t.split(",")[1]),t=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);return new Blob([i],{type:t})},getOuterHtml:function(t){return p("<div>").append(p(t).eq(0).clone()).html()},cloneAttributes:function(t,e){t=t[0]||t,e=p(e);for(var i=t.attributes,o=i.length;o--;){var s=i[o];e.attr(s.name,s.value)}return e},breakBlockTag:function(){var t,e,i=this.selection.block();return!!i&&(t=this.utils.isEmpty(i.innerHTML),"pre"!==(e=i.tagName.toLowerCase()))&&"li"!==e&&"td"!==e&&"th"!==e&&(!t&&this.utils.isStartOfElement(i)?{$block:p(i),$next:p(i).next(),type:"start"}:!t&&this.utils.isEndOfElement(i)?{$block:p(i),$next:p(i).next(),type:"end"}:(t=this.selection.extractEndOfNode(i),e=p("<"+e+" />").append(t),e=this.utils.cloneAttributes(i,e),p(i).after(e),{$block:p(i),$next:e,type:"break"}))},inBlocks:function(t){t=p.isArray(t)?t:[t];for(var e,i=this.selection.blocks(),o=i.length,s=!1,r=0;r<o;r++)!1!==i[r]&&(e=i[r].tagName.toLowerCase(),-1!==p.inArray(e,t))&&(s=!0);return s},inInlines:function(t){t=p.isArray(t)?t:[t];for(var e=this.selection.inlines(),i=e.length,o=!1,s=0;s<i;s++){var r=e[s].tagName.toLowerCase();-1!==p.inArray(r,t)&&(o=!0)}return o},isTag:function(t,e){t=p(t).closest(e,this.core.editor()[0]);return 1===t.length&&t[0]},isBlock:function(t){return null!==t&&(t=t[0]||t)&&this.utils.isBlockTag(t.tagName)},isBlockTag:function(t){return void 0!==t&&this.reIsBlock.test(t)},isInline:function(t){return(t=t[0]||t)&&this.utils.isInlineTag(t.tagName)},isInlineTag:function(t){return void 0!==t&&this.reIsInline.test(t)},isRedactorParent:function(t){return!!t&&0!==p(t).parents(".redactor-in").length&&!p(t).hasClass("redactor-in")&&t},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var i,o=this.selection.parent(),s=this.selection.current();return p.isArray(t)?(i=0,p.each(t,p.proxy(function(t,e){this.utils.isCurrentOrParentOne(s,o,e)&&i++},this)),0!==i):this.utils.isCurrentOrParentOne(s,o,t)},isCurrentOrParentOne:function(t,e,i){return i=i.toUpperCase(),e&&e.tagName===i?e:!(!t||t.tagName!==i)&&t},isEditorRelative:function(){var t=this.core.editor().css("position");return-1!==p.inArray(["absolute","fixed","relative"],t)},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var t=p(this.opts.scrollTarget);return 0!==t.length?t:p(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){void 0!==this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){void 0!==this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(t){return!(void 0===t&&!(t=this.selection.block()))&&0===this.offset.get(t)},isEndOfElement:function(t){var e;return!(void 0===t&&!(t=this.selection.block()))&&(e=p.trim(p(t).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,""),this.offset.get(t)===e.length)},removeEmptyAttr:function(t,e){t=p(t);return void 0===t.attr(e)||""===t.attr(e)&&(t.removeAttr(e),!0)},replaceToTag:function(t,e){var i;return p(t).replaceWith(function(){i=p("<"+e+" />").append(p(this).contents());for(var t=0;t<this.attributes.length;t++)i.attr(this.attributes[t].name,this.attributes[t].value);return i}),i},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){var t=p("html"),e=window.innerWidth,i=(e||(e=(i=document.documentElement.getBoundingClientRect()).right-Math.abs(i.left)),document.body.clientWidth<e),e=this.utils.measureScrollbar();t.css("overflow","hidden"),i&&t.css("padding-right",e)},measureScrollbar:function(){var t=p("body"),e=document.createElement("div"),i=(e.className="redactor-scrollbar-measure",t.append(e),e.offsetWidth-e.clientWidth);return t[0].removeChild(e),i},enableBodyScroll:function(){p("html").css({overflow:"","padding-right":""}),p("body").remove("redactor-scrollbar-measure")},appendFields:function(t,i){return t&&("object"==typeof t?p.each(t,function(t,e){null!==e&&0===e.toString().indexOf("#")&&(e=p(e).val()),i.append(t,e)}):0!==(t=p(t)).length&&t.each(function(){i.append(p(this).attr("name"),p(this).val())})),i},appendForms:function(t,i){return t&&0!==(t=p(t)).length&&(t=t.serializeArray(),p.each(t,function(t,e){i.append(e.name,e.value)})),i},isRgb:function(t){return 0===t.search(/^rgb/i)},rgb2hex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},p(window).on("load.tools.redactor",function(){p('[data-tools="redactor"]').redactor()}),a.prototype.init.prototype=a.prototype}(jQuery),function(r){function o(t,e,i,o){var s={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=e,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=r(t),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],"function"==typeof i?(o=i,this.opts=s):this.opts=r.extend(s,i),this.slide&&this.$element.height(this.$element.height()),this.init(o)}r.fn.redactorAnimation=function(t,e,i){return this.each(function(){new o(this,t,e,i)})},o.prototype={init:function(t){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof t&&t(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof t&&t(this)):this.animate(t)},animate:function(t){this.$element.addClass("redactor-animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var e=1<this.queue.length?null:t;this.complete("AnimationEnd",r.proxy(function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length)&&this.animate(t)},this),e)},set:function(t,e,i,o){for(var s=this.prefixes.length;s--;)this.$element.css(this.prefixes[s]+"animation-duration",t),this.$element.css(this.prefixes[s]+"animation-delay",e),this.$element.css(this.prefixes[s]+"animation-iteration-count",i),this.$element.css(this.prefixes[s]+"animation-timing-function",o)},clean:function(){this.$element.removeClass("redactor-animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(t,e,i){this.$element.one(t.toLowerCase()+" webkit"+t+" o"+t+" MS"+t,r.proxy(function(){"function"==typeof e&&e(),"function"==typeof i&&i(this);-1!==r.inArray(this.animation,["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"])&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")},this))}}}(jQuery),jQuery.Redactor.prototype.alignment=function(){return{langs:{en:{align:"Align","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify"}},init:function(){var t=this,e={},t=(e.left={title:t.lang.get("align-left"),func:t.alignment.setLeft},e.center={title:t.lang.get("align-center"),func:t.alignment.setCenter},e.right={title:t.lang.get("align-right"),func:t.alignment.setRight},e.justify={title:t.lang.get("align-justify"),func:t.alignment.setJustify},this.button.add("alignment",this.lang.get("align")));this.button.setIcon(t,'<i class="re-icon-alignment"></i>'),this.button.addDropdown(t,e)},removeAlign:function(){this.block.removeAttr("style")},setLeft:function(){this.buffer.set(),this.alignment.removeAlign()},setCenter:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addAttr({style:"text-align: center"}),this.core.editor().focus()},setRight:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addAttr({style:"text-align: right"}),this.core.editor().focus()},setJustify:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addAttr({style:"text-align: justify"}),this.core.editor().focus()}}};var RedactorPlugins=RedactorPlugins||{};!function(){"use strict";function t(e,r,i,o,t){return function(){var s;return{locfn:window.$_||function(t){return t},langs:{en:{"code-to-insert":"Code to insert","blockquote-to-insert":"Blockquote to insert"}},init:function(){s=this[e],o=s.locfn(o),s.initToolbar(),s.initEvents(),s.initModal()},initToolbar:function(){var t=this.button.add(e,o);this.button.addCallback(t,s.show),this.button.setIcon(t,'<i class="'+i+'"></i>')},initEvents:function(){var o=null;this.$editor.on("keydown.redactor-"+e,$.proxy(function(t){t.which!=this.keyCode.DOWN&&t.which!=this.keyCode.UP||(o=this.caret.getOffset())},this)),this.$editor.on("keyup.redactor-"+e,$.proxy(function(t){if((t.which==this.keyCode.DOWN||t.which==this.keyCode.UP)&&o==this.caret.getOffset()){var e=$(this.selection.getBlock());if(e.length&&e.is(r)){var i=t.which==this.keyCode.DOWN?e.next():e.prev();if(i.length){if(""!=$.trim(i.text()))return;i.html("&#8203;")}else i=s.insertNewline(e),t.which==this.keyCode.UP&&i.insertBefore(e);this.caret.setStart(i)}}},this))},initModal:function(){this.modal.addTemplate(e,s.getTemplate()),this.modal.addCallback(e,function(){this.modal.getCancelButton(),this.modal.getActionButton(s.locfn("Insert")).on("click",function(){s.insertSnippet($("#h-"+e+"-textarea").val())})})},getTemplate:function(){return'<div class="modal-section" id="redactor-modal-'+e+'-insert"><section><label>'+this.lang.get(t)+'</label><textarea id="h-'+e+'-textarea" style="height: 200px"></textarea></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},show:function(){this.buffer.set(),this.selection.save(),this.modal.load(e,o,800),this.modal.show(),this.detect.isDesktop()&&setTimeout(function(){$("#h-"+e+"-textarea").focus()},1)},insertSnippet:function(t){this.modal.close(),this.selection.restore(),s.insertNewline($("<"+r+">").text(t).insertAfter(this.selection.current())),this.code.sync()},insertNewline:function(t){return $("<p>&#8203;</p>").insertAfter(t)}}}}RedactorPlugins.codeblock=t("codeblock","pre","re-icon-html","Insert code block","code-to-insert"),RedactorPlugins.blockquote=t("blockquote","blockquote","re-icon-clips","Insert quote","blockquote-to-insert"),$.wa&&($.wa.RedactorCodeblockPluginFactory=t)}(),function(p){p.Redactor.prototype.fontcolor=function(){return{langs:{en:{fontcolor:"Text Color","fontcolor-highlight":"Highlight","fontcolor-text":"Text","fontcolor-none":"None"}},init:function(){var t=["#ffffff","#000000","#ff0000","#cc0000","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#0000ff","#0000cc","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#00ff00","#00cc00","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#7bed0c","#59a60d","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#00ffff","#00cccc","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#ff00ff","#cc00cc","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],e=this.button.add("fontcolor",this.lang.get("fontcolor")),i=(this.button.setIcon(e,'<i class="re-icon-fontcolor"></i>'),this.button.addDropdown(e)),e=(i.attr("rel","fontcolor"),i.width(242),p('<div style="overflow: hidden; text-align: center;">')),o=p('<span rel="text" class="re-dropdown-box-selector-font" style="background: #eee; float: left; padding: 8px 0; cursor: pointer; font-size: 12px; width: 50%;">'+this.lang.get("fontcolor-text")+"</span>"),s=p('<span rel="back" class="re-dropdown-box-selector-font" style="float: left; padding: 8px 0; cursor: pointer; font-size: 12px; width: 50%;">'+this.lang.get("fontcolor-highlight")+"</span>");e.append(o),e.append(s),i.append(e),this.fontcolor.buildPicker(i,"textcolor",t),this.fontcolor.buildPicker(i,"backcolor",t),o.on("mousedown",function(t){t.preventDefault(),i.find(".re-dropdown-box-selector-font").css("background","none"),i.find(".re-dropdown-box-backcolor").hide(),i.find(".re-dropdown-box-textcolor").show(),p(this).css("background","#eee")}),s.on("mousedown",function(t){t.preventDefault(),i.find(".re-dropdown-box-selector-font").css("background","none"),i.find(".re-dropdown-box-textcolor").hide(),i.find(".re-dropdown-box-backcolor").show(),p(this).css("background","#eee")})},buildPicker:function(t,e,i){function o(t){t.preventDefault(),a.fontcolor.set(p(this).data("rule"),p(this).attr("rel"))}for(var s=p('<div class="re-dropdown-box-'+e+'">'),r="backcolor"==e?"background-color":"color",n=i.length,a=this,l=0;l<n;l++){var c=i[l],d=p('<a rel="'+c+'" data-rule="'+r+'" href="#" style="float: left; box-sizing: border-box; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');d.css("background-color",c),d.on("mousedown",o),s.append(d)}var h=p('<a href="#" style="display: block; clear: both; padding: 8px 5px; box-sizing: border-box; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("fontcolor-none"));h.on("mousedown",p.proxy(function(t){t.preventDefault(),this.fontcolor.remove(r)},this)),s.append(h),t.append(s),"backcolor"==e&&s.hide()},set:function(t,e){this.inline.format("span","style",t+": "+e+";"),this.dropdown.hide()},remove:function(t){this.inline.removeStyleRule(t),this.dropdown.hide()}}}}(jQuery),function(e){e.Redactor.prototype.fontfamily=function(){return{langs:{en:{fontfamily:"Font","fontfamily-remove":"Remove Font Family"}},init:function(){var i=this,o={},t=(e.each(["Arial","Helvetica","Georgia","Times New Roman","Verdana","Monospace"],function(t,e){o["s"+t]={title:e,func:function(){i.fontfamily.set(e)}}}),o.remove={title:this.lang.get("fontfamily-remove"),func:i.fontfamily.reset},this.button.add("fontfamily",this.lang.get("fontfamily")));this.button.setIcon(t,'<i class="re-icon-fontfamily"></i>'),this.button.addDropdown(t,o)},set:function(t){this.inline.format("span","style","font-family:"+t+";")},reset:function(){this.inline.removeStyleRule("font-family")}}}}(jQuery),function(e){e.Redactor.prototype.fontsize=function(){return{langs:{en:{fontsize:"Size","fontsize-remove":"Remove Font Size"}},init:function(){var i=this,o={},t=(e.each([10,11,12,14,16,18,20,24,28,30],function(t,e){o["s"+t]={title:e+"px",func:function(){i.fontsize.set(e)}}}),o.remove={title:this.lang.get("fontsize-remove"),func:i.fontsize.reset},this.button.add("fontsize",this.lang.get("fontsize")));this.button.setIcon(t,'<i class="re-icon-fontsize"></i>'),this.button.addDropdown(t,o)},set:function(t){this.inline.format("span","style","font-size: "+t+"px;")},reset:function(){this.inline.removeStyleRule("font-size")}}}}(jQuery),function(e){e.Redactor.prototype.inlinestyle=function(){return{langs:{en:{style:"Style","style-marked":"Marked","style-code":"Code","style-sample":"Sample","style-variable":"Variable","style-shortcut":"Shortcut","style-cite":"Cite","style-sup":"Superscript","style-sub":"Subscript"}},init:function(){var i=this,o={},t=(e.each({marked:{title:"style-marked",args:["mark"]},code:{title:"style-code",args:["code"]},sample:{title:"style-sample",args:["samp"]},variable:{title:"style-variable",args:["var"]},shortcut:{title:"style-shortcut",args:["kbd"]},cite:{title:"style-cite",args:["cite"]},sup:{title:"style-sup",args:["sup"]},sub:{title:"style-sub",args:["sub"]}},function(t,e){o[t]={title:i.lang.get(e.title),func:"inline.format",args:e.args}}),this.button.addAfter("format","inline",this.lang.get("style")));this.button.setIcon(t,'<i class="re-icon-inline"></i>'),this.button.addDropdown(t,o)}}}}(jQuery),function(r){r.Redactor.prototype.properties=function(){return{langs:{en:{properties:"Properties"}},block:!1,labelStyle:{position:"absolute",padding:"2px 5px","line-height":1,"border-radius":"5px","font-size":"10px",color:"rgba(255, 255, 255, .9)","z-index":99},getTemplate:function(){return String()+'<div class="modal-section" id="redactor-modal-properties"><section><label id="modal-properties-id-label">Id</label><input type="text" id="modal-properties-id" /></section><section><label id="modal-properties-class-label">Class</label><input type="text" id="modal-properties-class" /></section><section><button id="redactor-modal-button-action">Save</button><button id="redactor-modal-button-cancel">Cancel</button></section></div>'},setup:function(){this.opts.properties=void 0===this.opts.properties?{}:this.opts.properties,this.opts.properties.id=void 0===this.opts.properties.id||this.opts.properties.id,this.opts.properties.classname=void 0===this.opts.properties.classname||this.opts.properties.classname,this.opts.properties.show=void 0!==this.opts.properties.show&&this.opts.properties.show},init:function(){var t;"pre"!==this.opts.type&&"inline"!==this.opts.type&&(this.properties.setup(),this.properties.createLabelId(this.properties.labelStyle),this.properties.createLabelClass(this.properties.labelStyle),this.properties.setEvents(),t=this.button.add("properties",this.lang.get("properties")),this.button.setIcon(t,'<i class="re-icon-properties"></i>'),this.button.addCallback(t,this.properties.show))},show:function(){this.modal.addTemplate("properties",this.properties.getTemplate()),this.modal.load("properties","Properties",600),this.modal.getActionButton().text("Save").on("click",this.properties.save),this.properties.showId(),this.properties.showClass(),this.modal.show()},createLabelId:function(t){(this.opts.properties.show||this.opts.properties.id)&&(this.properties.labelId=r("<span />").attr("id","redactor-properties-label-id-"+this.uuid).attr("title","ID").hide(),this.properties.labelId.css(t).css("background","rgba(229, 57, 143, .7)"),r("body").append(this.properties.labelId))},createLabelClass:function(t){(this.opts.properties.show||this.opts.properties.classname)&&(this.properties.labelClass=r("<span />").attr("id","redactor-properties-label-class-"+this.uuid).attr("title","class").hide(),this.properties.labelClass.css(t).css("background","rgba(61, 121, 242, .7)"),r("body").append(this.properties.labelClass))},setEvents:function(){this.core.element().on("click.callback.redactor",this.properties.showOnClick),r(document).on("mousedown.redactor-properties",r.proxy(this.properties.hideOnBlur,this)),this.core.element().on("destroy.callback.redactor",r.proxy(function(){r(document).off(".redactor-properties")},this))},showId:function(){this.opts.properties.id?(r("#modal-properties-id-label").show(),r("#modal-properties-id").show().val(r(this.properties.block).attr("id"))):r("#modal-properties-id, #modal-properties-id-label").hide()},showClass:function(){this.opts.properties.classname?(r("#modal-properties-class-label").show(),r("#modal-properties-class").show().val(r(this.properties.block).attr("class"))):r("#modal-properties-class, #modal-properties-class-label").hide()},save:function(){var t;this.opts.properties.id&&(void 0===(t=r("#modal-properties-id").val())||""===t?this.block.removeAttr("id",this.properties.block):this.block.replaceAttr("id",t,this.properties.block)),this.opts.properties.classname&&(void 0===(t=r("#modal-properties-class").val())||""===t?this.block.removeAttr("class",this.properties.block):this.block.replaceClass(t,this.properties.block)),this.modal.close(),this.properties.showOnClick(!1)},showOnClick:function(t){!1!==t&&t.preventDefault();var e,i,t=void 0!==this.fullscreen&&this.fullscreen.isOpen?1052:99;this.properties.block=this.selection.block(),this.properties.block&&this.utils.isRedactorParent(this.properties.block)&&!this.utils.isCurrentOrParent(["figure","li"])&&(e=r(this.properties.block).offset(),i=this.properties.showOnClickClass(e,t),this.properties.showOnClickId(e,t,i))},showOnClickId:function(e,i,o){var s=r(this.properties.block).attr("id");this.opts.properties.show&&this.opts.properties.id&&void 0!==s&&""!==s&&setTimeout(r.proxy(function(){var t=this.opts.properties.classname&&void 0!==o&&""!==o?this.properties.labelClass.innerWidth():-3;this.properties.labelId.css({zIndex:i,top:e.top-13,left:e.left+t}).show().text("#"+s)},this),10)},showOnClickClass:function(t,e){var i=r(this.properties.block).attr("class");return this.opts.properties.show&&this.opts.properties.classname&&void 0!==i&&""!==i&&this.properties.labelClass.css({zIndex:e,top:t.top-13,left:t.left-3}).show().text(i),i},hideOnBlur:function(t){t.target!==this.properties.block&&(this.properties.hideOnBlurId(),this.properties.hideOnBlurClass())},hideOnBlurId:function(){this.opts.properties.show&&this.opts.properties.id&&this.properties.labelId.css("z-index",99).hide()},hideOnBlurClass:function(){this.opts.properties.show&&this.opts.properties.classname&&this.properties.labelClass.css("z-index",99).hide()}}}}(jQuery),function(o){o.Redactor.prototype.source=function(){return{init:function(){var t=this.button.addFirst("html","HTML");this.button.setIcon(t,'<i class="re-icon-html"></i>'),this.button.addCallback(t,this.source.toggle);this.source.$textarea=o("<textarea />"),this.source.$textarea.css({width:"100%",margin:"0",background:"#1d1d1d","box-sizing":"border-box",color:"#ccc","font-size":"15px",outline:"none",padding:"20px","line-height":"24px","font-family":'Consolas, Menlo, Monaco, "Courier New", monospace'}).hide(),"textarea"===this.opts.type?this.core.box().append(this.source.$textarea):this.core.box().after(this.source.$textarea),this.core.element().on("destroy.callback.redactor",o.proxy(function(){this.source.$textarea.remove()},this))},toggle:function(){this.source.$textarea.hasClass("open")?this.source.hide():(this.source.show(),this.source.$textarea.on("keyup.redactor-source",o.proxy(function(){var t=this.source.$textarea.val();this.core.callback("change",t)},this)))},setCaretOnShow:function(){this.source.offset=this.offset.get();o(window).scrollTop(),this.core.editor().innerWidth(),this.core.editor().innerHeight();this.source.start=0,this.source.end=0;var t,e=o("<div/>").append(o.parseHTML(this.core.editor().html(),document,!0)),i=e.find("span.redactor-selection-marker");0<i.length&&(t=e.html().replace(/&amp;/g,"&"),1===i.length?(this.source.start=this.utils.strpos(t,e.find("#selection-marker-1").prop("outerHTML")),this.source.end=this.source.start):2===i.length&&(this.source.start=this.utils.strpos(t,e.find("#selection-marker-1").prop("outerHTML")),this.source.end=this.utils.strpos(t,e.find("#selection-marker-2").prop("outerHTML"))-e.find("#selection-marker-1").prop("outerHTML").toString().length))},setCaretOnHide:function(t){var e,i;return this.source.start=this.source.$textarea.get(0).selectionStart,this.source.end=this.source.$textarea.get(0).selectionEnd,this.source.start>this.source.end&&0<this.source.end&&(i=this.source.end,e=this.source.start,this.source.start=i,this.source.end=e),this.source.start=this.source.enlargeOffset(t,this.source.start),this.source.end=this.source.enlargeOffset(t,this.source.end),t=t.substr(0,this.source.start)+this.marker.html(1)+t.substr(this.source.start),this.source.end>this.source.start&&(i=this.marker.html(1).toString().length,t=t.substr(0,this.source.end+i)+this.marker.html(2)+t.substr(this.source.end+i)),t},hide:function(){this.source.$textarea.removeClass("open").hide(),this.source.$textarea.off(".redactor-source");var t=this.source.$textarea.val(),t=this.paragraphize.load(t);t=(t=this.source.setCaretOnHide(t)).replace('&amp;<span id="selection-marker-1" class="redactor-selection-marker">​</span>','<span id="selection-marker-1" class="redactor-selection-marker">​</span>&amp;'),this.code.start(t),this.button.enableAll(),this.core.editor().show().focus(),this.selection.restore(),this.placeholder.enable(),this.core.callback("visual")},show:function(){this.selection.save(),this.source.setCaretOnShow();var t=this.core.editor().height(),e=this.code.get(),e=this.core.callback("source",e);this.core.editor().hide(),this.button.disableAll("html"),this.source.$textarea.val(e).height(t).addClass("open").show(),this.source.$textarea.on("keyup.redactor-source",o.proxy(function(){"textarea"===this.opts.type&&this.core.textarea().val(this.source.$textarea.val())},this)),this.marker.remove(),o(window).scrollTop(scroll),this.source.$textarea[0].setSelectionRange&&this.source.$textarea[0].setSelectionRange(this.source.start,this.source.end),this.source.$textarea[0].scrollTop=0,setTimeout(o.proxy(function(){this.source.$textarea.focus()},this),0)},enlargeOffset:function(t,e){var i=t.length,o=0;if(">"===t[e])o++;else for(var s=e;s<=i&&(o++,">"!==t[s]);s++)if("<"===t[s]||s===i){o=0;break}return e+o}}}}(jQuery),function(a){a.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var t={},e=(t.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table",in:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},this.button.addBefore("link","table",this.lang.get("table")));this.button.setIcon(e,'<i class="re-icon-table"></i>'),this.button.addDropdown(e,t)},insert:function(){if(!this.table.getTable()){this.placeholder.hide();for(var t=a("<div>"),e=a("<table />"),i=0;i<2;i++){for(var o=a("<tr>"),s=0;s<3;s++){var r=a("<td>"+this.opts.invisibleSpace+"</td>");0===i&&0===s&&r.append(this.marker.get()),a(o).append(r)}e.append(o)}t.append(e);var t=t.html(),n=(this.buffer.set(),this.selection.current());0!==a(n).closest("li",this.core.editor()[0]).length?a(n).closest("ul, ol").first().after(t):(this.air.collapsed(),this.insert.html(t)),this.selection.restore(),this.core.callback("insertedTable",e)}},getTable:function(){var t=a(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(t)&&0!==t.length&&t},restoreAfterDelete:function(t){this.selection.restore(),t.find("span.redactor-selection-marker").remove()},deleteTable:function(){var t,e=this.table.getTable();e&&(this.buffer.set(),t=e.next(),this.opts.linebreaks||0===t.length?this.caret.after(e):this.caret.start(t),e.remove())},deleteRow:function(){var t,e,i=this.table.getTable();i&&(t=a(this.selection.current()),this.buffer.set(),(e=(t=t.closest("tr")).prev().length?t.prev():t.next()).length&&(e=e.children("td, th").first()).length&&e.prepend(this.marker.get()),t.remove(),this.table.restoreAfterDelete(i))},deleteColumn:function(){var o,t=this.table.getTable();t&&(this.buffer.set(),o=a(this.selection.current()).closest("td, th")[0].cellIndex,t.find("tr").each(a.proxy(function(t,e){var e=a(e),i=o-1<0?o+1:o-1;0===t&&e.find("td, th").eq(i).prepend(this.marker.get()),e.find("td, th").eq(o).remove()},this)),this.table.restoreAfterDelete(t))},addHead:function(){var t,e=this.table.getTable();e&&(this.buffer.set(),0!==e.find("thead").length?this.table.deleteHead():((t=e.find("tr").first().clone()).find("td").replaceWith(a.proxy(function(){return a("<th>").html(this.opts.invisibleSpace)},this)),$thead=a("<thead></thead>").append(t),e.prepend($thead)))},deleteHead:function(){var t=this.table.getTable();t&&0!==(t=t.find("thead")).length&&(this.buffer.set(),t.remove())},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(t){var e,i;this.table.getTable()&&(this.buffer.set(),(i=(e=a(this.selection.current()).closest("tr")).clone()).find("th").replaceWith(function(){var t=a("<td>");return t[0].attributes=this.attributes,t.append(a(this).contents())}),i.find("td").html(this.opts.invisibleSpace),"after"===t?e.after(i):e.before(i))},addColumn:function(o){var s,t,e,i,r=this.table.getTable();r&&(s=0,t=a(this.selection.current()),this.buffer.set(),e=t.closest("tr"),i=t.closest("td, th"),e.find("td, th").each(a.proxy(function(t,e){a(e)[0]===i[0]&&(s=t)},this)),r.find("tr").each(a.proxy(function(t,e){var e=a(e).find("td, th").eq(s),i=e.clone();i.html(this.opts.invisibleSpace),"after"===o?e.after(i):e.before(i)},this)))}}}}(jQuery),function(s){s.Redactor.prototype.video=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reIframeYoutube:/.*src="https?:\/\/(www\.)?youtube.com\/embed\/(\w+).*/,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,reUrlVimeoChannel:/https?:\/\/(www\.)?vimeo.com\/channels\/.*\/(\d+)($|\/)/,reIframeVimeo:/.*src="https?:\/\/(www\.)?player.vimeo.com\/video\/(\d+).*/,langs:{en:{video:"Video","video-html-code":"Video Embed Code or Youtube/Vimeo Link"}},getTemplate:function(){return String()+'<div class="modal-section" id="redactor-modal-video-insert"><section><label>'+this.lang.get("video-html-code")+'</label><textarea id="redactor-insert-video-area" style="height: 160px;"></textarea></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},init:function(){var t=this.button.addAfter("image","video",this.lang.get("video"));this.button.setIcon(t,'<i class="re-icon-video"></i>'),this.button.addCallback(t,this.video.show)},show:function(){this.modal.addTemplate("video",this.video.getTemplate()),this.modal.load("video",this.lang.get("video"),700),this.modal.getActionButton().text(this.lang.get("insert")).on("click",this.video.insert),this.modal.show(),this.detect.isDesktop()&&setTimeout(function(){s("#redactor-insert-video-area").focus()},1)},insert:function(){var i,t,e=s("#redactor-insert-video-area").val(),o=e.match(/<iframe|<video|http/gi);o&&0!==o.length&&(i=["iframe","video"],e=e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,e){return-1===i.indexOf(e.toLowerCase())?"":t}),this.opts.videoContainerClass=void 0===this.opts.videoContainerClass?"video-container":this.opts.videoContainerClass,o='<div class="'+this.opts.videoContainerClass+'"><iframe style="width: 500px; height: 281px;" src="',t='" frameborder="0" allowfullscreen></iframe></div>',e=e.match(this.video.reUrlYoutube)?e.replace(this.video.reUrlYoutube,o+"//www.youtube.com/embed/$1"+t):e.match(this.video.reIframeYoutube)?e.replace(this.video.reIframeYoutube,o+"//www.youtube.com/embed/$2"+t):e.match(this.video.reUrlVimeo)?e.replace(this.video.reUrlVimeo,o+"//player.vimeo.com/video/$2"+t):e.match(this.video.reUrlVimeoChannel)?e.replace(this.video.reUrlVimeoChannel,o+"//player.vimeo.com/video/$2"+t):e.match(this.video.reIframeVimeo)?e.replace(this.video.reIframeVimeo,o+"//player.vimeo.com/video/$2"+t):'<div class="'+this.opts.videoContainerClass+'">'+e+"</div>"),this.modal.close(),this.placeholder.hide(),this.buffer.set(),this.air.collapsed(),this.insert.html(e)}}}}(jQuery);
//# sourceMappingURL=redactor.min.js.map
